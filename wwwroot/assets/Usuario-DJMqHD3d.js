import{j as z,r as l,k as w,o as B,c as a,b as F,d as o,f as g,t as i,F as h,g as y,u as T,a as s,l as U,_ as A}from"./index-Vd5CoYyF.js";import{a as k}from"./index-Dq7h7Pqt.js";import{N as D}from"./NavbarHome-BEfJQVTW.js";const V={class:"profile-page"},L={key:0},R={key:1,class:"profile-container"},j={class:"profile-section"},J={class:"avatar-section"},M=["src"],O={class:"avatar-upload-btn"},H={class:"profile-info"},X={class:"orders-section"},q={key:0,class:"empty-orders"},G={key:1},K={key:0,class:"empty-orders"},Q={key:1,class:"orders-container"},W={key:0,class:"order-list"},Y={class:"order-details"},Z={class:"order-date"},ee=["href"],oe={key:1,class:"no-orders"},te="/default-avatar.png",ae=z({__name:"Usuario",setup(se){const u="https://lecturasdjazz-api.onrender.com",b=T(),c=l(localStorage.getItem("token")||""),r=l(JSON.parse(localStorage.getItem("usuario")||"null")),N=l(r.value?.nombre||""),$=l(r.value?.telefono||""),f=l(`${u}/${(r.value?.fotoUrl||"default-avatar.png").replace(/^\/+/,"")}`),v=l([]),_=l(!0),C=w(()=>{const t={Pendiente:[],Completado:[],Rechazado:[]};for(const e of v.value)t[e.estado]?.push(e);return t});function I(t){return t==="Pendiente"?"🟡":t==="Completado"?"✅":"❌"}function S(t){return new Date(t).toLocaleString("es-MX")}function P(){f.value=te}function m(){localStorage.removeItem("token"),localStorage.removeItem("usuario"),b.push("/login")}async function E(t){const e=t.target.files?.[0];if(!e||!r.value)return;const d=new FormData;d.append("archivo",e);try{const{data:n}=await k.post(`${u}/api/usuario/upload-photo?userId=${r.value.id}`,d,{headers:{Authorization:`Bearer ${c.value}`,"Content-Type":"multipart/form-data"}});f.value=`${u}/${n.ruta}`,r.value.fotoUrl=n.ruta,localStorage.setItem("usuario",JSON.stringify(r.value))}catch(n){console.error("Error al subir imagen:",n)}}async function x(){try{const{data:t}=await k.get(`${u}/api/pedidos/mis-pedidos`,{headers:{Authorization:`Bearer ${c.value}`}});v.value=Array.isArray(t)?t:[]}catch(t){console.error("Error al cargar pedidos:",t),t?.response?.status===401&&m()}finally{_.value=!1}}return B(()=>{if(!c.value||!r.value){m();return}x()}),(t,e)=>(s(),a("div",V,[F(D),!c.value||!r.value?(s(),a("div",L,e[0]||(e[0]=[o("p",{style:{"text-align":"center","margin-top":"2rem"}},"No autenticado. Redirigiendo...",-1)]))):(s(),a("div",R,[e[7]||(e[7]=o("h1",{class:"profile-title"},"✨ Tu Perfil",-1)),o("div",j,[o("div",J,[o("img",{src:f.value,alt:"Foto de perfil",class:"profile-avatar",onError:P},null,40,M),o("label",O,[o("input",{type:"file",onChange:E,accept:"image/*",class:"file-input"},null,32),e[1]||(e[1]=g(" Cambiar foto "))])]),o("div",H,[o("p",null,[e[2]||(e[2]=o("strong",null,"Nombre:",-1)),g(" "+i(N.value),1)]),o("p",null,[e[3]||(e[3]=o("strong",null,"Teléfono:",-1)),g(" "+i($.value),1)]),o("button",{onClick:m,class:"logout-btn"},"Cerrar sesión")])]),o("div",X,[e[6]||(e[6]=o("h2",null,"📦 Tus Pedidos",-1)),_.value?(s(),a("div",q,e[4]||(e[4]=[o("p",null,"Cargando tus pedidos...",-1)]))):(s(),a("div",G,[v.value.length===0?(s(),a("div",K,e[5]||(e[5]=[o("p",null,"No has realizado pedidos aún.",-1)]))):(s(),a("div",Q,[(s(!0),a(h,null,y(C.value,(d,n)=>(s(),a("div",{class:"order-status",key:n},[o("h3",null,i(I(n))+" "+i(n),1),d.length?(s(),a("ul",W,[(s(!0),a(h,null,y(d,p=>(s(),a("li",{key:p.uuid,class:"order-item"},[o("div",Y,[o("strong",null,i(p.producto.titulo),1),o("span",Z,i(S(p.fechaPedido)),1)]),o("a",{href:`${U(u)}${p.comprobanteUrl}`,target:"_blank",class:"receipt-link"}," Ver comprobante ",8,ee)]))),128))])):(s(),a("p",oe,"No tienes pedidos "+i(n.toLowerCase())+".",1))]))),128))]))]))])]))]))}}),ie=A(ae,[["__scopeId","data-v-1b6e1e2c"]]);export{ie as default};
