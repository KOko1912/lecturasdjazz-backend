import{j as L,k as m,x as V,r as p,o as q,c as s,b as G,d as e,e as r,t as i,n as g,f as $,w as F,a as n,l as O,_ as H}from"./index-DvMzjJ6p.js";import{a as U}from"./index-Dq7h7Pqt.js";import{N as J}from"./NavbarHome-OIqstuiu.js";const K={class:"comprobante-page"},W={class:"comprobante-container"},X={key:0,class:"producto-card"},Q={class:"producto-image-container"},Y=["src","alt"],Z={key:1,class:"no-image"},ee={class:"producto-details"},oe={class:"producto-title"},te={class:"price-display"},ae={class:"current-price"},se={key:0,class:"price-details"},ne={class:"original-price"},ie={class:"discount-badge"},le={class:"producto-description"},re={key:1,class:"status-container"},de={class:"status-header"},ce={class:"status-details"},ue={class:"detail-item"},pe={class:"detail-text"},ve={class:"detail-item"},me={class:"detail-text"},fe={class:"detail-item"},_e={class:"detail-text"},he={key:0,class:"detail-item highlight"},ge={class:"detail-text"},be={key:1,class:"detail-item"},ye={key:0,class:"status-message success"},Ce={key:1,class:"status-message error"},ke={key:2,class:"upload-section"},we={class:"upload-title"},xe={key:0,class:"upload-placeholder"},ze={key:1,class:"file-preview"},Pe={class:"file-icon"},$e={class:"file-info"},Fe={class:"file-name"},Ue={class:"file-size"},je=["disabled"],Ee={key:0,class:"upload-note"},Me={class:"message-icon"},De={class:"modal-content"},Be={class:"modal-header"},Ne={class:"modal-body"},Ae={key:0,class:"image-viewer"},Ie=["src"],Te=["href"],Re={key:1,class:"document-viewer"},Se=["href"],Le=["href"],Ve={key:2,class:"no-comprobante"},qe=L({__name:"ComprobanteUser",setup(Ge){const f="https://lecturasdjazz-api.onrender.com",b=V();O();const j=m(()=>b.params.uuid.toLowerCase()),v=m(()=>b.query.pedidoUuid||null),l=p(null),a=p(null),d=p(null),c=p(""),_=p(!1),u=p(""),y=p(null),h=p(null),C=localStorage.getItem("token")||"",E=m(()=>{if(!l.value)return 0;const t=l.value.precio,o=l.value.enOferta?l.value.porcentajeOferta:0;return t*(1-o/100)}),M=m(()=>a.value?a.value.estado==="Completado"?"completed":a.value.estado==="Rechazado"?"rejected":"pending":""),k=m(()=>c.value.includes("‚ùå")?"error":"success");function D(t){return{Pendiente:"En Proceso",Completado:"Completado",Rechazado:"Rechazado"}[t]||t}function w(t){return t.startsWith("http")?t:`${f}${t}`}function B(t){return/\.(jpg|jpeg|png|gif)$/i.test(t)}function N(t){return/\.pdf$/i.test(t)?"üìÑ":/\.(jpg|jpeg|png|gif)$/i.test(t)?"üñºÔ∏è":"üìÅ"}function A(t){return t<1024?`${t} bytes`:t<1048576?`${(t/1024).toFixed(1)} KB`:`${(t/1048576).toFixed(1)} MB`}function I(t){return new Date(t).toLocaleDateString("es-MX",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}function x(){y.value?.click()}function T(t){u.value=t,_.value=!0,document.body.style.overflow="hidden"}function z(){_.value=!1,document.body.style.overflow=""}function R(t){const o=t.target.files;if(o&&o[0]){if(o[0].size>5*1024*1024){c.value="‚ùå El archivo es demasiado grande (m√°ximo 5MB)";return}d.value=o[0]}}async function P(){if(!v.value){c.value="‚ùå No se encontr√≥ el n√∫mero de pedido en la URL";return}try{const{data:t}=await U.get(`${f}/api/pedidos/${v.value}`,{headers:{Authorization:`Bearer ${C}`}});if(t.producto.uuid.toLowerCase()!==j.value){c.value="‚ùå Este pedido no corresponde al producto indicado";return}a.value=t,l.value=t.producto,t.estado==="Pendiente"&&(h.value=t.numeroListaEspera)}catch{c.value="‚ùå Error al cargar los datos del pedido"}}async function S(){if(!d.value||!v.value)return;const t=new FormData;t.append("comprobante",d.value),t.append("uuidPedido",v.value);try{await U.put(`${f}/api/pedidos/subir-comprobante`,t,{headers:{Authorization:`Bearer ${C}`,"Content-Type":"multipart/form-data"}}),c.value="‚úÖ Comprobante subido correctamente. Gracias por tu pago.",d.value=null,await P()}catch(o){c.value=o?.response?.data||"‚ùå Error al subir el comprobante. Por favor int√©ntalo nuevamente."}}return q(async()=>{v.value?await P():c.value="‚ùå Enlace inv√°lido: falta el n√∫mero de pedido"}),(t,o)=>(n(),s("div",K,[G(J),e("div",W,[o[10]||(o[10]=e("div",{class:"header-section"},[e("div",{class:"header-icon"},"üìã"),e("h1",{class:"page-title"},"Gesti√≥n de tu Pedido"),e("p",{class:"page-subtitle"},"Aqu√≠ puedes ver el estado y subir tu comprobante de pago")],-1)),l.value?(n(),s("div",X,[e("div",Q,[l.value.imagenUrl?(n(),s("img",{key:0,src:w(l.value.imagenUrl),alt:l.value.titulo,class:"producto-image"},null,8,Y)):(n(),s("div",Z," üñºÔ∏è Sin imagen "))]),e("div",ee,[e("h2",oe,i(l.value.titulo),1),e("div",te,[e("div",ae,"$"+i(E.value.toFixed(2)),1),l.value.enOferta?(n(),s("div",se,[e("span",ne,"Precio original: $"+i(l.value.precio.toFixed(2)),1),e("span",ie,"Ahorras "+i(l.value.porcentajeOferta)+"%",1)])):r("",!0)]),e("p",le,i(l.value.descripcion),1)])])):r("",!0),a.value?(n(),s("div",re,[e("div",de,[o[1]||(o[1]=e("h2",null,"Estado de tu pedido",-1)),e("div",{class:g(["status-badge",M.value])},i(D(a.value.estado)),3)]),e("div",ce,[e("div",ue,[o[2]||(o[2]=e("span",{class:"detail-icon"},"üìÖ",-1)),e("span",pe,"Fecha: "+i(I(a.value.fechaCreacion)),1)]),e("div",ve,[o[3]||(o[3]=e("span",{class:"detail-icon"},"üë§",-1)),e("span",me,"Cliente: "+i(a.value.usuario.nombre),1)]),e("div",fe,[o[4]||(o[4]=e("span",{class:"detail-icon"},"üìû",-1)),e("span",_e,"Tel√©fono: "+i(a.value.usuario.telefono),1)]),a.value.estado==="Pendiente"&&h.value!==null?(n(),s("div",he,[o[6]||(o[6]=e("span",{class:"detail-icon"},"‚è≥",-1)),e("span",ge,[o[5]||(o[5]=$("Tu posici√≥n en la lista: ")),e("strong",null,"#"+i(h.value),1)])])):r("",!0),a.value.comprobanteUrl?(n(),s("div",be,[o[7]||(o[7]=e("span",{class:"detail-icon"},"üìÑ",-1)),e("button",{class:"view-comprobante-btn",onClick:o[0]||(o[0]=Oe=>T(w(a.value.comprobanteUrl)))}," Ver comprobante actual ")])):r("",!0)]),a.value.estado==="Completado"?(n(),s("div",ye," ‚úÖ Tu pedido ha sido completado exitosamente ")):r("",!0),a.value.estado==="Rechazado"?(n(),s("div",Ce," ‚ùå Tu pedido fue rechazado. Por favor cont√°ctanos. ")):r("",!0)])):r("",!0),a.value&&a.value.estado==="Pendiente"?(n(),s("div",ke,[e("h2",we,i(a.value.comprobanteUrl?"Actualizar":"Subir")+" Comprobante ",1),o[9]||(o[9]=e("p",{class:"upload-instructions"}," Por favor sube una foto o PDF de tu comprobante de pago para procesar tu pedido. ",-1)),e("div",{class:g(["upload-box",{"has-file":d.value}]),onClick:x},[e("input",{id:"file-upload",type:"file",accept:".jpg,.jpeg,.png,.pdf",onChange:R,ref_key:"fileInput",ref:y},null,544),d.value?(n(),s("div",ze,[e("div",Pe,i(N(d.value.name)),1),e("div",$e,[e("p",Fe,i(d.value.name),1),e("p",Ue,i(A(d.value.size)),1)]),e("button",{class:"change-file",onClick:F(x,["stop"])}," Cambiar ")])):(n(),s("div",xe,o[8]||(o[8]=[e("div",{class:"upload-icon"},"üì§",-1),e("p",null,"Arrastra tu archivo aqu√≠ o haz clic para seleccionarlo",-1),e("p",{class:"file-requirements"},"Formatos: JPG, PNG, PDF (M√°x. 5MB)",-1)])))],2),e("button",{class:"submit-btn",disabled:!d.value,onClick:S},i(a.value.comprobanteUrl?"Actualizar Comprobante":"Enviar Comprobante"),9,je),a.value.comprobanteUrl?(n(),s("p",Ee," Puedes reemplazar el comprobante anterior si necesitas corregir algo. ")):r("",!0)])):r("",!0),c.value?(n(),s("div",{key:3,class:g(["feedback-message",k.value])},[e("span",Me,i(k.value==="error"?"‚ùå":"‚úÖ"),1),$(" "+i(c.value),1)],2)):r("",!0)]),_.value?(n(),s("div",{key:0,class:"comprobante-modal",onClick:F(z,["self"])},[e("div",De,[e("button",{class:"close-modal",onClick:z},o[11]||(o[11]=[e("span",null,"√ó",-1)])),e("div",Be,[o[12]||(o[12]=e("h3",null,"Comprobante de Pago",-1)),e("p",null,"Pedido #"+i(v.value?.substring(0,8)),1)]),e("div",Ne,[u.value&&B(u.value)?(n(),s("div",Ae,[e("img",{src:u.value,alt:"Comprobante de pago",class:"comprobante-image"},null,8,Ie),e("a",{href:u.value,download:"",class:"download-btn"}," Descargar imagen ",8,Te)])):u.value?(n(),s("div",Re,[o[13]||(o[13]=e("div",{class:"document-icon"},"üìÑ",-1)),o[14]||(o[14]=e("p",null,"Documento adjunto",-1)),e("a",{href:u.value,target:"_blank",class:"view-document"}," Abrir documento completo ",8,Se),e("a",{href:u.value,download:"",class:"download-btn"}," Descargar archivo ",8,Le)])):(n(),s("div",Ve," No hay comprobante disponible "))])])])):r("",!0)]))}}),We=H(qe,[["__scopeId","data-v-399a76ee"]]);export{We as default};
