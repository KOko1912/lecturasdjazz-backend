import{j as ae,p as C,q as oe,r as c,o as se,c as i,b as ie,e as b,d as e,t as r,s as y,u as ne,f as k,n as E,F as A,g as P,h as re,v as le,w as ce,a as n,_ as ue}from"./index-CW287Eje.js";import{a as de}from"./index-Dq7h7Pqt.js";import{N as ve}from"./NavbarHome-Cw61jy7t.js";const d=de.create({baseURL:"import.meta.env.VITE_API_URL",headers:{"Content-Type":"application/json"}}),pe={class:"product-page"},me={key:0,class:"loading-state"},fe={key:1,class:"error-state"},_e={class:"error-card"},ge={class:"error-message"},he={key:2,class:"product-container"},be={class:"product-main"},ke={class:"product-gallery"},ye={class:"main-image-container"},$e=["src","alt"],Ce={key:1,class:"no-image-placeholder"},we={key:2,class:"discount-badge"},xe={class:"product-info"},Ie={class:"product-header"},Ee={class:"product-meta"},Ue={class:"views"},Fe={class:"product-title"},De={class:"price-section"},Ne={class:"current-price"},Me={key:0,class:"original-price"},Oe={class:"product-description"},Ve={class:"product-actions"},Ae={class:"like-count"},Pe={class:"rating-section"},Re={class:"rating-container"},Te={class:"stars"},je=["onClick","onMouseover","aria-label"],Le={class:"rating-info"},Se={class:"user-rating"},ze={class:"average-rating"},qe={class:"comments-section"},Be={class:"section-header"},We={class:"comments-count"},Ge={class:"comment-form"},He=["disabled"],Xe={class:"form-actions"},Ye=["disabled"],Je={key:0,class:"login-notice"},Ke={key:0,class:"no-comments"},Qe={key:1,class:"comments-list"},Ze={class:"comment-header"},et={class:"user-info"},tt={class:"user-avatar"},at=["src","alt"],ot={key:1,class:"avatar-fallback"},st={class:"user-details"},it={class:"user-name"},nt={class:"comment-date"},rt={key:0,class:"comment-actions"},lt=["onClick"],ct=["onClick"],ut={class:"comment-content"},dt={class:"modal-content"},vt=["src"],pt=ae({__name:"ProductoDetalle",setup(mt){const R=oe(),T=ne(),g=C(()=>R.params.uuid),s=c(null),v=c(null),$=c([]),u=c(""),m=c(null),f=c(0),w=c(0),U=c(0),F=c(0),x=c(!1),I=c(!1),D=c(""),l=Number(localStorage.getItem("userId"))||0,N=localStorage.getItem("token")||"";(!l||!N)&&console.warn("Usuario no autenticado. Algunas funciones estar√°n desactivadas.");const j=C(()=>{if(!s.value)return 0;const a=s.value.precio,t=s.value.enOferta?s.value.porcentajeOferta:0;return a*(1-t/100)}),L=C(()=>s.value?s.value.stock>0?`${s.value.stock} disponibles`:"Agotado":"Desconocido"),M=C(()=>s.value?.imagenUrl?s.value.imagenUrl.startsWith("http")?s.value.imagenUrl:`http://localhost:5176${s.value.imagenUrl}`:"");function S(a){return a?a.startsWith("http")?a:`http://localhost:5176/${a}`:"/default-avatar.png"}function z(a){return new Date(a).toLocaleDateString("es-MX",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}function q(a){D.value=a,I.value=!0,document.body.style.overflow="hidden"}function O(){I.value=!1,document.body.style.overflow=""}async function B(){if(s.value)try{const a=new FormData;a.append("uuidProducto",s.value.uuid);const t=new File([" "],"comprobante-falso.txt",{type:"text/plain"});a.append("comprobante",t);const o=await d.post("/api/pedidos",a,{headers:{Authorization:`Bearer ${N}`,"Content-Type":"multipart/form-data"}}),{uuid:p,cliente:V,producto:_}=o.data,ee=_.enOferta?_.precio*(1-_.porcentajeOferta/100):_.precio,te=encodeURIComponent(`üì¶ *Nuevo pedido generado*

üë§ Cliente: ${V.nombre}
üìû Tel√©fono: ${V.telefono}

üßø Producto: *${_.titulo}*
üìù ${_.descripcion}
üí≤ Precio: $${ee.toFixed(2)} ${_.enOferta?`(antes $${_.precio.toFixed(2)})`:""}

üìé Subir comprobante:
http://localhost:5173/comprobante/${s.value.uuid}?pedidoUuid=${p}`);window.open(`https://wa.me/528444606458?text=${te}`,"_blank")}catch(a){const t=a?.response?.data;t&&t.includes("pedido pendiente")?alert("Ya tienes un pedido pendiente, ser√°s redirigido."):(console.error("Error creando pedido:",a),alert("‚ùå Ocurri√≥ un error al generar el link de compra."))}}async function W(){try{const{data:a}=await d.get(`/api/admin/productos/${g.value}`);s.value=a}catch(a){v.value=a.message||"Error al cargar producto"}}async function h(){try{const a=`/api/productos/${g.value}/reacciones`,[t,o,p]=await Promise.all([d.get(`${a}/comentarios`),d.get(`${a}/calificacion-promedio`,{params:{usuarioId:l}}),d.get(`${a}/likes`,{params:{usuarioId:l}})]);$.value=t.data,U.value=o.data.promedio,f.value=o.data.valorUsuario,F.value=p.data.likes,x.value=p.data.usuarioDioLike}catch(a){console.error("Error cargando reacciones",a)}}async function G(){if(u.value.trim())try{await d.post(`/api/productos/${g.value}/reacciones/comentarios`,{texto:u.value,usuarioId:l}),u.value="",await h()}catch{v.value="Error al enviar comentario"}}function H(a){u.value=a.texto,m.value=a.id}function X(){u.value="",m.value=null}async function Y(){if(m.value)try{await d.put(`/api/productos/${g.value}/reacciones/comentarios/${m.value}`,{texto:u.value,usuarioId:l}),u.value="",m.value=null,await h()}catch{v.value="Error actualizando comentario"}}async function J(a){if(confirm("¬øEst√°s seguro de que quieres eliminar este comentario?"))try{await d.delete(`/api/productos/${g.value}/reacciones/comentarios/${a}?usuarioId=${l}`),await h()}catch{v.value="Error eliminando comentario"}}function K(a){f.value=a,Q()}async function Q(){if(!(f.value<1||f.value>5))try{await d.post(`/api/productos/${g.value}/reacciones/calificacion`,{valor:f.value,usuarioId:l}),await h()}catch{v.value="Error al calificar"}}async function Z(){try{await d.post(`/api/productos/${g.value}/reacciones/like`,{accion:x.value?"quitar":"agregar",usuarioId:l}),await h()}catch{v.value="Error al dar like"}}return se(async()=>{await W(),await h()}),(a,t)=>(n(),i("div",pe,[ie(ve),s.value===null&&v.value===null?(n(),i("div",me,t[5]||(t[5]=[e("div",{class:"loading-spinner"},null,-1),e("p",{class:"loading-text"},"Cargando detalles del producto...",-1)]))):v.value?(n(),i("div",fe,[e("div",_e,[t[6]||(t[6]=e("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),t[7]||(t[7]=e("h3",{class:"error-title"},"Error al cargar el producto",-1)),e("p",ge,r(v.value),1),e("button",{class:"btn btn-secondary",onClick:t[0]||(t[0]=o=>y(T).push("/"))}," Volver al inicio ")])])):(n(),i("div",he,[t[20]||(t[20]=e("nav",{class:"breadcrumbs"},[e("a",{href:"/"},"Inicio"),e("span",{class:"separator"},"/"),e("span",{class:"current"},"Producto")],-1)),e("div",be,[e("div",ke,[e("div",ye,[s.value?.imagenUrl?(n(),i("img",{key:0,src:M.value,alt:s.value.titulo,class:"main-image",onClick:t[1]||(t[1]=o=>q(M.value))},null,8,$e)):(n(),i("div",Ce,t[8]||(t[8]=[e("div",{class:"placeholder-icon"},"üÉè",-1),e("p",null,"Imagen no disponible",-1)]))),s.value?.enOferta?(n(),i("div",we," -"+r(s.value.porcentajeOferta)+"% ",1)):b("",!0)])]),e("div",xe,[e("div",Ie,[e("div",Ee,[e("span",Ue,[t[9]||(t[9]=e("i",{class:"meta-icon"},"üëÅÔ∏è",-1)),k(" "+r(s.value.conteoVisitas)+" visitas ",1)]),e("span",{class:E(["stock-status",{"out-of-stock":s.value.stock<=0}])},[t[10]||(t[10]=e("i",{class:"meta-icon"},"üì¶",-1)),k(" "+r(L.value),1)],2)]),e("h1",Fe,r(s.value.titulo),1),e("div",De,[e("div",Ne,"$"+r(j.value.toFixed(2)),1),s.value.enOferta?(n(),i("div",Me," $"+r(s.value.precio.toFixed(2)),1)):b("",!0)])]),e("div",Oe,[t[11]||(t[11]=e("h3",{class:"section-title"},"Descripci√≥n",-1)),e("p",null,r(s.value.descripcion),1)]),e("div",Ve,[e("button",{class:"btn btn-primary whatsapp-btn",onClick:B},t[12]||(t[12]=[e("i",{class:"btn-icon"},"üí¨",-1),k(" Consultar por WhatsApp ")])),e("button",{class:E(["like-btn",{liked:x.value}]),onClick:Z,"aria-label":"Dar like al producto"},[t[13]||(t[13]=e("span",{class:"like-icon"},"‚ù§Ô∏è",-1)),e("span",Ae,r(F.value),1)],2)]),e("div",Pe,[t[16]||(t[16]=e("h3",{class:"section-title"},"Calificaci√≥n",-1)),e("div",Re,[e("div",Te,[(n(),i(A,null,P(5,o=>e("span",{key:o,onClick:p=>K(o),onMouseover:p=>w.value=o,onMouseleave:t[2]||(t[2]=p=>w.value=f.value),class:E(["star",{active:o<=(w.value||f.value)}]),"aria-label":`Calificar con ${o} estrellas`}," ‚òÖ ",42,je)),64))]),e("div",Le,[e("div",Se,[t[14]||(t[14]=k(" Tu calificaci√≥n: ")),e("strong",null,r(f.value||"-"),1)]),e("div",ze,[t[15]||(t[15]=k(" Promedio: ")),e("strong",null,r(U.value.toFixed(1)),1)])])])])])]),e("div",qe,[e("div",Be,[t[17]||(t[17]=e("h2",{class:"section-title"},"Comentarios",-1)),e("div",We,r($.value.length)+" comentarios",1)]),e("div",Ge,[re(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=o=>u.value=o),placeholder:"Escribe tu comentario sobre este producto...",class:"comment-input",disabled:!y(l)},null,8,He),[[le,u.value]]),e("div",Xe,[e("button",{class:"btn btn-primary submit-btn",onClick:t[4]||(t[4]=o=>m.value?Y():G()),disabled:!u.value.trim()||!y(l)},r(m.value?"Actualizar comentario":"Publicar comentario"),9,Ye),m.value?(n(),i("button",{key:0,class:"btn btn-secondary cancel-btn",onClick:X}," Cancelar ")):b("",!0)]),y(l)?b("",!0):(n(),i("p",Je,t[18]||(t[18]=[e("a",{href:"/login"},"Inicia sesi√≥n",-1),k(" para dejar un comentario. ")])))]),$.value.length===0?(n(),i("div",Ke,t[19]||(t[19]=[e("div",{class:"empty-state"},[e("i",{class:"empty-icon"},"üí¨"),e("h3",null,"No hay comentarios a√∫n"),e("p",null,"S√© el primero en compartir tu opini√≥n sobre este producto")],-1)]))):(n(),i("div",Qe,[(n(!0),i(A,null,P($.value,o=>(n(),i("div",{key:o.id,class:"comment-item"},[e("div",Ze,[e("div",et,[e("div",tt,[o.usuarioFoto?(n(),i("img",{key:0,src:S(o.usuarioFoto),alt:o.usuarioNombre,class:"avatar-image"},null,8,at)):(n(),i("div",ot,r(o.usuarioNombre.charAt(0).toUpperCase()),1))]),e("div",st,[e("span",it,r(o.usuarioNombre),1),e("span",nt,r(z(o.fecha)),1)])]),o.usuarioId===y(l)?(n(),i("div",rt,[e("button",{class:"action-btn edit-btn",onClick:p=>H(o),"aria-label":"Editar comentario"}," ‚úèÔ∏è ",8,lt),e("button",{class:"action-btn delete-btn",onClick:p=>J(o.id),"aria-label":"Eliminar comentario"}," üóëÔ∏è ",8,ct)])):b("",!0)]),e("div",ut,[e("p",null,r(o.texto),1)])]))),128))]))])])),I.value?(n(),i("div",{key:3,class:"image-modal",onClick:ce(O,["self"])},[e("div",dt,[e("button",{class:"close-modal",onClick:O},"√ó"),e("img",{src:D.value,alt:"Vista ampliada del producto"},null,8,vt)])])):b("",!0)]))}}),ht=ue(pt,[["__scopeId","data-v-b7ecc842"]]);export{ht as default};
