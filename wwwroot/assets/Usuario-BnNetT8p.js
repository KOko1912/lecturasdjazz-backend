import{a as N}from"./index-Dq7h7Pqt.js";import{j as _,r as i,k as y,o as R,c as r,b as A,d as o,u as U,f as F,t as u,F as h,g as k,a as n,l as V}from"./index-DvMzjJ6p.js";import{u as j,N as M}from"./NavbarHome-OIqstuiu.js";import H from"./Login-DY-gBvLK.js";const J={key:0},O={key:1},X={key:2},q=["src"],G={key:0},K={key:1},Q={key:0},W={key:1},I="/default-avatar.png",ae=_({__name:"Usuario",setup(Y){const{token:P,usuario:l,logout:c,isLoggedIn:C}=j();V();const f="https://lecturasdjazz-api.onrender.com",p=i(""),m=i(""),d=i(""),s=i([]),$=i(!0),b=i(!0),L=y(()=>s.value.filter(t=>t.estado==="Pendiente")),S=y(()=>s.value.filter(t=>t.estado==="Completado")),x=y(()=>s.value.filter(t=>t.estado==="Rechazado"));function g(t){return new Date(t).toLocaleString("es-MX")}async function B(t){const e=t.target.files?.[0];if(!e||!l.value)return;const a=new FormData;a.append("archivo",e);try{const{data:v}=await N.post(`${f}/api/usuario/upload-photo?userId=${l.value.id}`,a,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${P.value}`}});d.value=`${f}/${v.ruta}`,l.value.fotoUrl=v.ruta,localStorage.setItem("usuario",JSON.stringify(l.value))}catch(v){console.error("Error subiendo imagen:",v)}}function z(){if(!l.value||!l.value.id){c();return}p.value=l.value.nombre,m.value=l.value.telefono,d.value=`${f}/${(l.value.fotoUrl||I).replace(/^\/+/,"")}`,E()}async function E(){try{const{data:t}=await N.get(`${f}/api/pedidos/mis-pedidos`,{headers:{Authorization:`Bearer ${P.value}`}});s.value=Array.isArray(t)?t:[]}catch(t){t?.response?.status===401&&c(),console.error("Error al cargar pedidos:",t)}finally{$.value=!1}}function T(){c(),p.value="",m.value="",d.value="",s.value=[]}function w(){d.value=I}function D(){z()}return R(()=>{C()&&z(),b.value=!1}),(t,e)=>(n(),r("div",null,[A(M),b.value?(n(),r("div",J,e[0]||(e[0]=[o("p",{style:{"text-align":"center","margin-top":"2rem"}},"Cargando...",-1)]))):U(C)()?(n(),r("div",X,[e[9]||(e[9]=o("h1",null,"✨ Tu Perfil",-1)),o("div",null,[o("img",{src:d.value,alt:"Foto de perfil",onError:w},null,40,q),o("input",{type:"file",onChange:B,accept:"image/*"},null,32)]),o("div",null,[o("p",null,[e[1]||(e[1]=o("strong",null,"Nombre:",-1)),F(" "+u(p.value),1)]),o("p",null,[e[2]||(e[2]=o("strong",null,"Teléfono:",-1)),F(" "+u(m.value),1)]),o("button",{onClick:T},"Cerrar sesión")]),o("div",null,[e[8]||(e[8]=o("h2",null,"📦 Tus Pedidos",-1)),$.value?(n(),r("div",G,e[3]||(e[3]=[o("p",null,"Cargando tus pedidos...",-1)]))):(n(),r("div",K,[s.value.length===0?(n(),r("div",Q,e[4]||(e[4]=[o("p",null,"No tienes pedidos.",-1)]))):(n(),r("div",W,[e[5]||(e[5]=o("h3",null,"🟡 Pendientes",-1)),o("ul",null,[(n(!0),r(h,null,k(L.value,a=>(n(),r("li",{key:a.uuid},u(a.producto.titulo)+" - "+u(g(a.fechaPedido)),1))),128))]),e[6]||(e[6]=o("h3",null,"✅ Aprobados",-1)),o("ul",null,[(n(!0),r(h,null,k(S.value,a=>(n(),r("li",{key:a.uuid},u(a.producto.titulo)+" - "+u(g(a.fechaPedido)),1))),128))]),e[7]||(e[7]=o("h3",null,"❌ Rechazados",-1)),o("ul",null,[(n(!0),r(h,null,k(x.value,a=>(n(),r("li",{key:a.uuid},u(a.producto.titulo)+" - "+u(g(a.fechaPedido)),1))),128))])]))]))])])):(n(),r("div",O,[A(H,{onLogueado:D})]))]))}});export{ae as default};
