import{j as E,r as u,k as m,o as F,c as a,b as P,d as e,f as v,t as l,F as h,g,a as r,u as R,l as S,m as T,p as U,_ as L}from"./index-BNhqJ-ys.js";import{a as w}from"./index-Dq7h7Pqt.js";import{N as j}from"./NavbarHome-K9bsUF0l.js";import{u as M}from"./useAuth-Bw392SW3.js";const H={class:"profile-page"},J={class:"profile-container"},O={class:"profile-section"},X={class:"avatar-section"},q=["src"],G={class:"avatar-upload-btn"},K={class:"profile-info"},Q={class:"orders-section"},W={key:0,class:"empty-orders"},Y={key:1},Z={key:0,class:"empty-orders"},ee={key:1,class:"orders-container"},oe={class:"order-status"},te={key:0,class:"order-list"},se={class:"order-details"},ae={class:"order-date"},re={key:1,class:"no-orders"},ne={class:"order-status"},le={key:0,class:"order-list"},ie={class:"order-details"},de={class:"order-date"},ue=["href"],ce={key:1,class:"no-orders"},pe={class:"order-status"},fe={key:0,class:"order-list"},ve={class:"order-details"},_e={class:"order-date"},me=["href"],he={key:1,class:"no-orders"},ge="/default-avatar.png",ye=E({__name:"Usuario",setup(be){const{token:y,usuario:n,logout:c,isLoggedIn:I}=M();R();const i="https://lecturasdjazz-api.onrender.com",b=u(""),k=u(""),p=u(""),d=u([]),$=u(!0),N=m(()=>d.value.filter(s=>s.estado==="Pendiente")),z=m(()=>d.value.filter(s=>s.estado==="Completado")),C=m(()=>d.value.filter(s=>s.estado==="Rechazado"));function _(s){return new Date(s).toLocaleDateString("es-MX",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}function x(){c()}function A(s){p.value=ge}async function V(){try{const{data:s}=await w.get(`${i}/api/pedidos/mis-pedidos`,{headers:{Authorization:`Bearer ${y.value}`}});d.value=Array.isArray(s)?s:[]}catch(s){console.error("❌ Error al cargar pedidos:",s),s?.response?.status===401&&c()}finally{$.value=!1}}async function B(s){const o=s.target.files?.[0];if(!o||!n.value)return;const f=new FormData;f.append("archivo",o);try{const{data:t}=await w.post(`${i}/api/usuario/upload-photo?userId=${n.value.id}`,f,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${y.value}`}});p.value=`${i}/${t.ruta}`,n.value.fotoUrl=t.ruta,localStorage.setItem("usuario",JSON.stringify(n.value))}catch(t){console.error("❌ Error subiendo imagen:",t)}}function D(){if(!n.value||!n.value.id){console.warn("⛔ Usuario inválido. Redirigiendo a login..."),c();return}b.value=n.value.nombre||"",k.value=n.value.telefono||"",p.value=`${i}/${(n.value.fotoUrl||"default-avatar.png").replace(/^\/+/,"")}`,V()}return F(()=>{if(!I()){console.warn("⛔ Usuario no autenticado. Redirigiendo a /login"),c();return}D()}),(s,o)=>{const f=S("router-link");return r(),a("div",H,[P(j),e("div",J,[o[10]||(o[10]=e("h1",{class:"profile-title"},"✨ Tu Perfil",-1)),e("div",O,[e("div",X,[e("img",{src:p.value,alt:"Foto de perfil",class:"profile-avatar",onError:A},null,40,q),e("label",G,[e("input",{type:"file",onChange:B,accept:"image/*",class:"file-input"},null,32),o[0]||(o[0]=v(" Cambiar foto "))])]),e("div",K,[e("p",null,[o[1]||(o[1]=e("strong",null,"Nombre:",-1)),v(" "+l(b.value),1)]),e("p",null,[o[2]||(o[2]=e("strong",null,"Teléfono:",-1)),v(" "+l(k.value),1)]),e("button",{onClick:x,class:"logout-btn"},"Cerrar sesión")])]),e("div",Q,[o[9]||(o[9]=e("h2",null,"📦 Tus Pedidos",-1)),$.value?(r(),a("div",W,o[3]||(o[3]=[e("p",null,"Cargando tus pedidos...",-1)]))):(r(),a("div",Y,[d.value.length===0?(r(),a("div",Z,o[4]||(o[4]=[e("p",null,"No has realizado pedidos aún.",-1)]))):(r(),a("div",ee,[e("div",oe,[o[6]||(o[6]=e("h3",null,"🟡 Pendientes",-1)),N.value.length?(r(),a("ul",te,[(r(!0),a(h,null,g(N.value,t=>(r(),a("li",{key:t.uuid,class:"order-item"},[e("div",se,[e("strong",null,l(t.producto.titulo),1),e("span",ae,l(_(t.fechaPedido)),1)]),P(f,{to:`/comprobante/${t.producto.uuid}?pedidoUuid=${t.uuid}`,class:"receipt-link"},{default:T(()=>o[5]||(o[5]=[v(" Ver comprobante ")])),_:2,__:[5]},1032,["to"])]))),128))])):(r(),a("p",re,"No tienes pedidos pendientes."))]),e("div",ne,[o[7]||(o[7]=e("h3",null,"✅ Aprobados",-1)),z.value.length?(r(),a("ul",le,[(r(!0),a(h,null,g(z.value,t=>(r(),a("li",{key:t.uuid,class:"order-item"},[e("div",ie,[e("strong",null,l(t.producto.titulo),1),e("span",de,l(_(t.fechaPedido)),1)]),e("a",{href:`${U(i)}${t.comprobanteUrl}`,target:"_blank",class:"receipt-link"}," Ver comprobante ",8,ue)]))),128))])):(r(),a("p",ce,"No tienes pedidos aprobados."))]),e("div",pe,[o[8]||(o[8]=e("h3",null,"❌ Rechazados",-1)),C.value.length?(r(),a("ul",fe,[(r(!0),a(h,null,g(C.value,t=>(r(),a("li",{key:t.uuid,class:"order-item"},[e("div",ve,[e("strong",null,l(t.producto.titulo),1),e("span",_e,l(_(t.fechaPedido)),1)]),e("a",{href:`${U(i)}${t.comprobanteUrl}`,target:"_blank",class:"receipt-link"}," Ver comprobante ",8,me)]))),128))])):(r(),a("p",he,"No tienes pedidos rechazados."))])]))]))])])])}}}),Ce=L(ye,[["__scopeId","data-v-7ebb13bb"]]);export{Ce as default};
