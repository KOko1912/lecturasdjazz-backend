import{j as se,r as i,k as I,o as te,c as n,b as ae,d as o,e as r,h as X,E as ne,v as le,t as a,f as d,F as ie,g as de,w as re,l as G,a as l,n as W,_ as ce}from"./index-Vd5CoYyF.js";import{N as ue}from"./NavbarAdmin-h5m7T1ln.js";import{a as pe}from"./index-Dq7h7Pqt.js";const w=pe.create({baseURL:"https://lecturasdjazz-api.onrender.com"});w.interceptors.request.use(E=>{const b=localStorage.getItem("token");return b&&(E.headers.Authorization=`Bearer ${b}`),E});const ve={class:"admin-pedidos-container"},me={class:"admin-content"},fe={class:"pedidos-header"},be={class:"filtros-container"},ge={class:"filtro-group"},Ce={class:"filtro-group"},he={class:"estadisticas-grid"},_e={class:"estadistica-card total"},ke={class:"estadistica-info"},ye={class:"estadistica-card completados"},ze={class:"estadistica-info"},Pe={class:"estadistica-card pendientes"},$e={class:"estadistica-info"},Ae={class:"estadistica-card rechazados"},we={class:"estadistica-info"},Ee={class:"pedidos-table-container"},Me={key:0,class:"loading-state"},Re={key:1,class:"empty-state"},De={key:2,class:"table-responsive"},Le={class:"pedidos-table"},xe={key:0},Fe={key:0},Ve={key:0},je={"data-label":"ID"},Ie={"data-label":"Producto"},Ne={class:"producto-info"},Se={class:"producto-nombre"},qe={class:"producto-precio"},Be={"data-label":"Cliente"},Ue={class:"cliente-info"},Te={class:"cliente-nombre"},Xe={class:"cliente-telefono"},Ge=["onClick"],We={"data-label":"Fecha"},He={"data-label":"Estado"},Je={"data-label":"Comprobante"},Ke=["onClick"],Oe={key:1},Qe={"data-label":"Acciones"},Ye={class:"acciones-container"},Ze=["onClick"],eo=["onClick"],oo={key:2,class:"accion-realizada"},so={key:0,class:"paginacion"},to=["disabled"],ao={class:"pagina-info"},no=["disabled"],lo={key:1,class:"modal-overlay"},io={class:"modal-content"},ro={class:"modal-comprobante"},co={class:"comprobante-contenido"},uo=["src"],po={key:1,class:"comprobante-no-disponible"},vo=["href"],A=10,mo=se({__name:"VentasPage",setup(E){const b="https://lecturasdjazz-api.onrender.com",C=i([]),M=i(!0),h=i("todos"),_=i(""),u=i(1),p=i("fechaPedido"),c=i("desc"),R=i(!1),D=i(""),L=i(""),v=i(""),g=i(null),x=i(!1),m=i(""),F=i(0),k=i(0),y=i(0),z=i(0),P=I(()=>{let s=[...C.value];if(h.value!=="todos"&&(s=s.filter(e=>e.estado===h.value)),_.value){const e=_.value.toLowerCase();s=s.filter(t=>t.usuario?.nombre?.toLowerCase().includes(e)||t.producto?.titulo?.toLowerCase().includes(e)||t.id.toString().includes(e))}return s.sort((e,t)=>{const f=e[p.value],T=t[p.value];return f<T?c.value==="asc"?-1:1:f>T?c.value==="asc"?1:-1:0}),s}),N=I(()=>Math.ceil(P.value.length/A)),H=I(()=>{const s=(u.value-1)*A,e=s+A;return P.value.slice(s,e)});function J(s){return{Pendiente:"En espera",Completado:"Aceptado",Rechazado:"Rechazado"}[s]||s}function K(s){return{Completado:"Aceptado",Rechazado:"Rechazado"}[s]||"‚Äî"}async function S(){try{M.value=!0;const s=await w.get("/api/admin/pedidosadmin");C.value=s.data,O()}catch(s){console.error("Error al cargar pedidos:",s),$("Error al cargar pedidos","error")}finally{M.value=!1}}function O(){F.value=0,k.value=0,y.value=0,z.value=0,C.value.forEach(s=>{s.estado==="Completado"?(F.value+=s.precioFinal??0,k.value++):s.estado==="Pendiente"?y.value++:s.estado==="Rechazado"&&z.value++})}function V(s){const e=C.value.length;return e>0?Math.round(s/e*100):0}function j(s){p.value===s?c.value=c.value==="asc"?"desc":"asc":(p.value=s,c.value="asc"),u.value=1}function Q(s){const e=s.replace(/\D/g,"");window.open(`https://wa.me/${e}`,"_blank")}function Y(s){m.value=s,x.value=!0}function q(){x.value=!1,m.value=""}function Z(s){return/\.(jpg|jpeg|png|gif|webp)$/i.test(s)}function B(s,e){g.value=s,v.value=e,e==="aprobar"?(D.value="¬øAprobar pedido?",L.value="¬øEst√°s seguro de que deseas aceptar este pedido?"):e==="rechazar"&&(D.value="¬øRechazar pedido?",L.value="¬øEst√°s seguro de que deseas rechazar este pedido?"),R.value=!0}async function ee(){if(g.value)try{v.value==="aprobar"?(await w.put(`/api/admin/pedidosadmin/${g.value}/completar`),$("Pedido aceptado correctamente","success")):v.value==="rechazar"&&(await w.put(`/api/admin/pedidosadmin/${g.value}/rechazar`),$("Pedido rechazado correctamente","success")),await S()}catch(s){console.error(`Error al ${v.value} pedido:`,s),$(`Error al ${v.value} pedido`,"error")}finally{U()}}function U(){R.value=!1,g.value=null,v.value=""}function $(s,e){console.log(`[${e.toUpperCase()}] ${s}`)}function oe(s){return new Date(s).toLocaleDateString("es-MX",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}return te(()=>{S()}),(s,e)=>(l(),n("div",ve,[ae(ue),o("div",me,[o("div",fe,[e[10]||(e[10]=o("h1",{class:"text-gradient"},"üìä Gesti√≥n de Pedidos",-1)),o("div",be,[o("div",ge,[e[8]||(e[8]=o("label",{for:"filtro-estado"},"Estado:",-1)),X(o("select",{id:"filtro-estado","onUpdate:modelValue":e[0]||(e[0]=t=>h.value=t),class:"filtro-select"},e[7]||(e[7]=[o("option",{value:"todos"},"Todos",-1),o("option",{value:"Pendiente"},"Pendientes",-1),o("option",{value:"Completado"},"Completados",-1),o("option",{value:"Rechazado"},"Rechazados",-1)]),512),[[ne,h.value]])]),o("div",Ce,[e[9]||(e[9]=o("label",{for:"busqueda"},"Buscar:",-1)),X(o("input",{id:"busqueda",type:"text","onUpdate:modelValue":e[1]||(e[1]=t=>_.value=t),placeholder:"ID, cliente o producto...",class:"filtro-input"},null,512),[[le,_.value]])])])]),o("div",he,[o("div",_e,[e[12]||(e[12]=o("div",{class:"estadistica-icon"},"üí∞",-1)),o("div",ke,[e[11]||(e[11]=o("h3",null,"Ingresos totales",-1)),o("p",null,"$"+a(F.value.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2})),1)])]),o("div",ye,[e[14]||(e[14]=o("div",{class:"estadistica-icon"},"‚úÖ",-1)),o("div",ze,[e[13]||(e[13]=o("h3",null,"Completados",-1)),o("p",null,[d(a(k.value)+" ",1),o("span",null,"("+a(V(k.value))+"%)",1)])])]),o("div",Pe,[e[16]||(e[16]=o("div",{class:"estadistica-icon"},"‚è≥",-1)),o("div",$e,[e[15]||(e[15]=o("h3",null,"Pendientes",-1)),o("p",null,[d(a(y.value)+" ",1),o("span",null,"("+a(V(y.value))+"%)",1)])])]),o("div",Ae,[e[18]||(e[18]=o("div",{class:"estadistica-icon"},"‚ùå",-1)),o("div",we,[e[17]||(e[17]=o("h3",null,"Rechazados",-1)),o("p",null,[d(a(z.value)+" ",1),o("span",null,"("+a(V(z.value))+"%)",1)])])])]),o("div",Ee,[M.value?(l(),n("div",Me,e[19]||(e[19]=[o("div",{class:"spinner"},null,-1),o("p",null,"Cargando pedidos...",-1)]))):P.value.length===0?(l(),n("div",Re,e[20]||(e[20]=[o("i",{class:"icon"},"üì≠",-1),o("p",null,"No se encontraron pedidos con los filtros actuales",-1)]))):(l(),n("div",De,[o("table",Le,[o("thead",null,[o("tr",null,[o("th",{onClick:e[2]||(e[2]=t=>j("id")),class:"sortable"},[e[21]||(e[21]=d(" ID ")),p.value==="id"?(l(),n("span",xe,a(c.value==="asc"?"‚Üë":"‚Üì"),1)):r("",!0)]),e[24]||(e[24]=o("th",null,"Producto",-1)),e[25]||(e[25]=o("th",null,"Cliente",-1)),o("th",{onClick:e[3]||(e[3]=t=>j("fechaPedido")),class:"sortable"},[e[22]||(e[22]=d(" Fecha ")),p.value==="fechaPedido"?(l(),n("span",Fe,a(c.value==="asc"?"‚Üë":"‚Üì"),1)):r("",!0)]),o("th",{onClick:e[4]||(e[4]=t=>j("estado")),class:"sortable"},[e[23]||(e[23]=d(" Estado ")),p.value==="estado"?(l(),n("span",Ve,a(c.value==="asc"?"‚Üë":"‚Üì"),1)):r("",!0)]),e[26]||(e[26]=o("th",null,"Comprobante",-1)),e[27]||(e[27]=o("th",null,"Acciones",-1))])]),o("tbody",null,[(l(!0),n(ie,null,de(H.value,t=>(l(),n("tr",{key:t.id,class:W("estado-"+t.estado.toLowerCase())},[o("td",je,a(t.id),1),o("td",Ie,[o("div",Ne,[o("span",Se,a(t.producto?.titulo||"‚Äî"),1),o("span",qe," $"+a((t.precioFinal||0).toLocaleString("es-MX")),1)])]),o("td",Be,[o("div",Ue,[o("span",Te,a(t.usuario?.nombre||"‚Äî"),1),o("span",Xe,a(t.usuario?.telefono||"‚Äî"),1),t.usuario?.telefono?(l(),n("button",{key:0,onClick:f=>Q(t.usuario.telefono),class:"btn-whatsapp"},e[28]||(e[28]=[o("i",{class:"icon"},"üí¨",-1),d(" Enviar mensaje ")]),8,Ge)):r("",!0)])]),o("td",We,a(oe(t.fechaPedido)),1),o("td",He,[o("span",{class:W(["estado-badge",t.estado.toLowerCase()])},a(J(t.estado)),3)]),o("td",Je,[t.comprobanteUrl?(l(),n("button",{key:0,onClick:f=>Y(t.comprobanteUrl),class:"btn-comprobante"},e[29]||(e[29]=[o("i",{class:"icon"},"üìÑ",-1),d(" Ver ")]),8,Ke)):(l(),n("span",Oe,"‚Äî"))]),o("td",Qe,[o("div",Ye,[t.estado==="Pendiente"?(l(),n("button",{key:0,onClick:f=>B(t.id,"aprobar"),class:"btn-accion aprobar"},e[30]||(e[30]=[o("i",{class:"icon"},"‚úÖ",-1),d(" Aprobar ")]),8,Ze)):r("",!0),t.estado==="Pendiente"?(l(),n("button",{key:1,onClick:f=>B(t.id,"rechazar"),class:"btn-accion rechazar"},e[31]||(e[31]=[o("i",{class:"icon"},"‚ùå",-1),d(" Rechazar ")]),8,eo)):r("",!0),t.estado!=="Pendiente"?(l(),n("span",oo,a(K(t.estado)),1)):r("",!0)])])],2))),128))])])]))]),P.value.length>A?(l(),n("div",so,[o("button",{onClick:e[5]||(e[5]=t=>u.value--),disabled:u.value===1,class:"btn-paginacion"}," ‚óÄ Anterior ",8,to),o("span",ao," P√°gina "+a(u.value)+" de "+a(N.value),1),o("button",{onClick:e[6]||(e[6]=t=>u.value++),disabled:u.value===N.value,class:"btn-paginacion"}," Siguiente ‚ñ∂ ",8,no)])):r("",!0),R.value?(l(),n("div",lo,[o("div",io,[o("h3",null,a(D.value),1),o("p",null,a(L.value),1),o("div",{class:"modal-buttons"},[o("button",{onClick:ee,class:"btn-modal confirmar"},e[32]||(e[32]=[o("i",{class:"icon"},"‚úî",-1),d(" Confirmar ")])),o("button",{onClick:U,class:"btn-modal cancelar"},e[33]||(e[33]=[o("i",{class:"icon"},"‚úñ",-1),d(" Cancelar ")]))])])])):r("",!0),x.value?(l(),n("div",{key:2,class:"modal-overlay",onClick:re(q,["self"])},[o("div",ro,[o("button",{class:"btn-cerrar-modal",onClick:q},e[34]||(e[34]=[o("i",{class:"icon"},"‚úñ",-1)])),e[38]||(e[38]=o("h3",null,"Comprobante de pago",-1)),o("div",co,[m.value&&Z(m.value)?(l(),n("img",{key:0,src:`${G(b)}${m.value}`,alt:"Comprobante de pago",class:"imagen-comprobante"},null,8,uo)):(l(),n("div",po,[e[36]||(e[36]=o("i",{class:"icon"},"üìÑ",-1)),e[37]||(e[37]=o("p",null,"Comprobante no disponible en formato de imagen",-1)),o("a",{href:`${G(b)}${m.value}`,target:"_blank",class:"btn-descargar"},e[35]||(e[35]=[o("i",{class:"icon"},"‚¨áÔ∏è",-1),d(" Descargar archivo ")]),8,vo)]))])])])):r("",!0)])]))}}),Co=ce(mo,[["__scopeId","data-v-05e96a8d"]]);export{Co as default};
