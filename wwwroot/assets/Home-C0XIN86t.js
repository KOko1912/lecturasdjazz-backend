import{_ as U,r as h,o as V,c as t,a as i,b,d as s,e as p,f as z,F as g,g as f,t as l,n as E,w as y,h as x,v as I,i as M}from"./index---WEDpbZ.js";import{a as u}from"./index-Dq7h7Pqt.js";import{N as P}from"./NavbarHome-B1G55MOg.js";const T={class:"app-container"},S={class:"main-content"},B={class:"feed-section"},F={class:"feed-header"},H={class:"section-title"},K=["src"],J={key:0,class:"no-posts"},j=["src"],A={class:"publicaciones-grid"},R=["onClick"],W={class:"publicacion-header"},X=["src"],Y={class:"admin-nombre"},q={class:"fecha"},G={class:"descripcion"},O={key:0,class:"media-container"},Q=["src"],Z={key:1,class:"media-container"},ee=["src"],se={class:"acciones"},oe=["onClick"],ae={class:"heart-icon"},te={class:"like-count"},ie={key:1,class:"login-msg"},ne={class:"comentarios"},re=["src"],ce=["onClick"],le={key:0,class:"nuevo-comentario"},de=["onUpdate:modelValue","onKeyup"],ue={key:1,class:"load-more"},_e=10,me={__name:"Home",setup(ve){const c="https://lecturasdjazz-api.onrender.com",_=h([]),m=h({}),r=h(null),k=h(10),d=e=>e?e.startsWith("http")?e:`${c}/${e.replace(/^\/?/,"")}`:`${c}/file.png`,L=e=>new Date(e).toLocaleString("es-MX"),$=async()=>{const e=localStorage.getItem("userId");if(e)try{const o=await u.get(`${c}/api/usuario/detalle/${e}`);r.value=o.data}catch(o){console.error("Error al cargar usuario logueado:",o)}},v=async()=>{try{const e=await u.get(`${c}/api/publicaciones`);_.value=e.data.map(o=>({...o,yaDioLike:o.usuarioYaDioLike||!1}))}catch(e){console.error("Error al obtener publicaciones:",e)}},C=async e=>{if(r.value)try{e.yaDioLike=!e.yaDioLike,e.totalLikes+=e.yaDioLike?1:-1,await u.post(`${c}/api/publicaciones/${e.id}/like`,{usuarioId:r.value.id}),setTimeout(()=>v(),500)}catch(o){console.error("Error al dar like:",o)}},w=async e=>{const o=m.value[e]?.trim();if(!(!o||!r.value))try{await u.post(`${c}/api/publicaciones/${e}/comentario`,{comentario:o,usuarioId:r.value.id}),m.value[e]="",v()}catch(a){console.error("Error al comentar:",a)}},D=async(e,o)=>{try{await u.delete(`${c}/api/publicaciones/${e}/comentario/${o}`,{data:{usuarioId:r.value.id}}),v()}catch(a){console.error("Error al eliminar comentario:",a)}},N=()=>{k.value+=_e};return V(()=>{$(),v()}),(e,o)=>(i(),t("div",T,[b(P),s("div",S,[o[3]||(o[3]=s("div",{class:"mystical-overlay"},null,-1)),s("section",B,[s("div",F,[s("h2",H,[s("img",{src:d("/file.png"),alt:"Lecturas del Tarot de Jazz",class:"brand-icon"},null,8,K),o[1]||(o[1]=z(" Publicaciones Recientes "))])]),_.value.length===0?(i(),t("div",J,[s("img",{src:d("/file.png"),alt:"Lecturas del Tarot de Jazz"},null,8,j),o[2]||(o[2]=s("p",null,"No hay publicaciones a√∫n. S√© el primero en compartir!",-1))])):p("",!0),s("div",A,[(i(!0),t(g,null,f(_.value.slice(0,k.value),a=>(i(),t("div",{key:a.id,class:"publicacion-card",onClick:n=>e.abrirPublicacion(a.id)},[s("div",W,[s("img",{class:"avatar",src:d(a.fotoAdmin||"/file.png"),alt:"admin-avatar"},null,8,X),s("div",null,[s("p",Y,l(a.adminNombre),1),s("p",q,l(L(a.fechaCreacion)),1)])]),s("p",G,l(a.descripcion),1),a.esVideo?(i(),t("div",O,[s("video",{class:"media",controls:"",src:d(a.mediaUrl)},null,8,Q)])):(i(),t("div",Z,[s("img",{class:"media",src:d(a.mediaUrl)},null,8,ee)])),s("div",se,[r.value?(i(),t("button",{key:0,onClick:y(n=>C(a),["stop"]),class:E(["btn-like",{liked:a.yaDioLike}])},[s("span",ae,l(a.yaDioLike?"üíî":"‚ù§Ô∏è"),1),s("span",te,l(a.totalLikes),1)],10,oe)):(i(),t("span",ie,"Inicia sesi√≥n para dar like"))]),s("div",ne,[(i(!0),t(g,null,f(a.comentarios,n=>(i(),t("div",{key:n.id,class:"comentario"},[s("img",{class:"avatar",src:d(n.fotoUsuarioUrl||"/file.png"),alt:"avatar"},null,8,re),s("div",null,[s("strong",null,l(n.usuarioNombre),1),s("p",null,l(n.comentario),1)]),r.value&&n.usuarioId===r.value.id?(i(),t("button",{key:0,onClick:y(he=>D(a.id,n.id),["stop"]),class:"btn-delete"},"‚ùå",8,ce)):p("",!0)]))),128)),r.value?(i(),t("div",le,[x(s("input",{"onUpdate:modelValue":n=>m.value[a.id]=n,placeholder:"Escribe tu comentario...",class:"form-control",onKeyup:M(n=>w(a.id),["enter"]),onClick:o[0]||(o[0]=y(()=>{},["stop"]))},null,40,de),[[I,m.value[a.id]]])])):p("",!0)])],8,R))),128))]),_.value.length>k.value?(i(),t("div",ue,[s("button",{onClick:N,class:"btn-load-more"},"Ver m√°s publicaciones")])):p("",!0)])])]))}},ge=U(me,[["__scopeId","data-v-3f595029"]]);export{ge as default};
