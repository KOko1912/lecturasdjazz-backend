import{a as k}from"./index-Dq7h7Pqt.js";import{j as b,r as s,k as m,o as w,c as l,e as A,d as o,f as P,t as u,F as g,g as y,a as n}from"./index-Dy9PrGVy.js";const B={key:0},E=["src"],F={key:0},x={key:1},D="/default-avatar.png",J=b({__name:"Usuario",setup(U){const i="https://lecturasdjazz-api.onrender.com",r=s(null),d=s(null),c=s(""),f=s([]),h=s(!0),S=m(()=>f.value.filter(a=>a.estado==="Pendiente")),$=m(()=>f.value.filter(a=>a.estado==="Completado")),C=m(()=>f.value.filter(a=>a.estado==="Rechazado"));function p(a){return new Date(a).toLocaleString("es-MX")}function z(){localStorage.clear(),location.reload()}function I(){c.value=D}async function N(){if(d.value)try{const{data:a}=await k.get(`${i}/api/pedidos/mis-pedidos`,{headers:{Authorization:`Bearer ${d.value}`}});f.value=Array.isArray(a)?a:[]}catch(a){console.error("Error al cargar pedidos:",a)}finally{h.value=!1}}async function T(a){const e=a.target.files?.[0];if(!e||!r.value)return;const t=new FormData;t.append("archivo",e);try{const{data:v}=await k.post(`${i}/api/usuario/upload-photo?userId=${r.value.id}`,t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${d.value}`}});c.value=`${i}/${v.ruta}`,r.value.fotoUrl=v.ruta,localStorage.setItem("usuario",JSON.stringify(r.value))}catch(v){console.error("Error subiendo imagen:",v)}}return w(()=>{const a=localStorage.getItem("usuario"),e=localStorage.getItem("token");a&&e?(r.value=JSON.parse(a),d.value=e,c.value=`${i}/${(r.value.fotoUrl||"default-avatar.png").replace(/^\/+/,"")}`,N()):console.warn("No hay sesión activa.")}),(a,e)=>r.value?(n(),l("div",B,[e[6]||(e[6]=o("h1",null,"✨ Tu Perfil",-1)),o("div",null,[o("img",{src:c.value,alt:"Foto de perfil",onError:I},null,40,E),o("input",{type:"file",onChange:T,accept:"image/*"},null,32)]),o("div",null,[o("p",null,[e[0]||(e[0]=o("strong",null,"Nombre:",-1)),P(" "+u(r.value.nombre),1)]),o("p",null,[e[1]||(e[1]=o("strong",null,"Teléfono:",-1)),P(" "+u(r.value.telefono),1)]),o("button",{onClick:z},"Cerrar sesión")]),o("div",null,[e[5]||(e[5]=o("h2",null,"📦 Tus Pedidos",-1)),h.value?(n(),l("div",F,"Cargando...")):(n(),l("div",x,[o("div",null,[e[2]||(e[2]=o("h3",null,"🟡 Pendientes",-1)),o("ul",null,[(n(!0),l(g,null,y(S.value,t=>(n(),l("li",{key:t.uuid},u(t.producto.titulo)+" - "+u(p(t.fechaPedido)),1))),128))])]),o("div",null,[e[3]||(e[3]=o("h3",null,"✅ Aprobados",-1)),o("ul",null,[(n(!0),l(g,null,y($.value,t=>(n(),l("li",{key:t.uuid},u(t.producto.titulo)+" - "+u(p(t.fechaPedido)),1))),128))])]),o("div",null,[e[4]||(e[4]=o("h3",null,"❌ Rechazados",-1)),o("ul",null,[(n(!0),l(g,null,y(C.value,t=>(n(),l("li",{key:t.uuid},u(t.producto.titulo)+" - "+u(p(t.fechaPedido)),1))),128))])])]))])])):A("",!0)}});export{J as default};
