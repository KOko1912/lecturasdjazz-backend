import{j as C,r as s,o as N,c as r,d as o,f as l,b as h,k as E,l as P,t as u,F as b,g as B,u as U,a}from"./index-B07QE0eD.js";import{a as k}from"./index-Dq7h7Pqt.js";const $={key:0},z={key:1},F=["src"],T={key:0},V={key:1},j="/default-avatar.png",M=C({__name:"Usuario",setup(A){const _=U(),f="https://lecturasdjazz-api.onrender.com",y=localStorage.getItem("token"),g=localStorage.getItem("usuario"),i=s(y),n=s(g?JSON.parse(g):null),d=s(""),m=s([]),v=s(!0);function S(){d.value=j}function c(){localStorage.removeItem("token"),localStorage.removeItem("usuario"),_.push("/login")}function I(t){return new Date(t).toLocaleString("es-MX")}async function w(){try{const{data:t}=await k.get(`${f}/api/pedidos/mis-pedidos`,{headers:{Authorization:`Bearer ${i.value}`}});m.value=t}catch(t){console.error("❌ Error al cargar pedidos:",t),k.isAxiosError(t)&&t.response?.status===401&&c()}finally{v.value=!1}}return N(()=>{if(!n.value||!i.value){console.warn("⛔ Usuario no autenticado. Redirigiendo..."),c();return}d.value=`${f}/${(n.value.fotoUrl||"default-avatar.png").replace(/^\/+/,"")}`,w()}),(t,e)=>{const x=P("router-link");return a(),r("div",null,[e[5]||(e[5]=o("h1",null,"👤 Perfil",-1)),!n.value||!i.value?(a(),r("div",$,[o("p",null,[e[1]||(e[1]=l("No estás autenticado. ")),h(x,{to:"/login"},{default:E(()=>e[0]||(e[0]=[l("Iniciar sesión")])),_:1,__:[0]})])])):(a(),r("div",z,[o("img",{src:d.value,onError:S},null,40,F),o("p",null,[e[2]||(e[2]=o("strong",null,"Nombre:",-1)),l(" "+u(n.value.nombre),1)]),o("p",null,[e[3]||(e[3]=o("strong",null,"Teléfono:",-1)),l(" "+u(n.value.telefono),1)]),o("button",{onClick:c},"Cerrar sesión"),e[4]||(e[4]=o("h2",null,"Pedidos",-1)),v.value?(a(),r("div",T,"Cargando pedidos...")):(a(),r("ul",V,[(a(!0),r(b,null,B(m.value,p=>(a(),r("li",{key:p.uuid},u(p.producto?.titulo)+" - "+u(I(p.fechaPedido)),1))),128))]))]))])}}});export{M as default};
