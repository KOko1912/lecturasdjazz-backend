import{j as C,r as l,o as k,c as s,b as w,d as e,h as x,v as P,e as $,F as D,g as N,a as n,t as v,_ as V}from"./index-CW287Eje.js";import{a as _}from"./index-Dq7h7Pqt.js";import{N as I}from"./NavbarAdmin-CLEppyrf.js";const U={class:"admin-publicaciones"},E={class:"contenedor"},S={class:"card"},A={class:"card mt-4"},F={key:0},B={class:"publicaciones-grid"},L={class:"header"},M=["src"],j={class:"descripcion"},z={key:0},T=["src"],W={key:1},X=["src"],q={class:"acciones"},G=["onClick"],H=C({__name:"Publicar",setup(J){const r="https://lecturasdjazz-api.onrender.com",o=l(""),c=l(null),d=l([]),u=l(null),p=t=>t?t.startsWith("http")?t:`${r}${t.startsWith("/")?"":"/"}${t}`:"https://via.placeholder.com/40",f=t=>{const i=t.target;i.files&&i.files[0]&&(c.value=i.files[0])},b=()=>{const t=localStorage.getItem("adminId");t&&(u.value=parseInt(t))},g=async()=>{if(!o.value||!c.value||!u.value){alert("Debes ingresar una descripción, seleccionar un archivo y tener un admin logueado");return}const i=c.value.name.split(".").pop()?.toLowerCase()==="mp4",a=new FormData;a.append("descripcion",o.value),a.append("esVideo",i.toString()),a.append("archivo",c.value),a.append("adminUserId",u.value.toString());try{await _.post(`${r}/api/publicaciones`,a,{headers:{"Content-Type":"multipart/form-data"}}),o.value="",c.value=null,await m()}catch(h){alert("Error al publicar"),console.error("Error al publicar:",h)}},y=async t=>{if(confirm("¿Deseas eliminar esta publicación?"))try{await _.delete(`${r}/api/publicaciones/${t}`),await m()}catch(i){console.error("Error al eliminar publicación:",i)}},m=async()=>{const t=await _.get(`${r}/api/publicaciones`);d.value=t.data};return k(()=>{b(),m()}),(t,i)=>(n(),s("div",U,[w(I),e("div",E,[i[3]||(i[3]=e("h1",{class:"titulo text-gradient"},"Publicar contenido nuevo",-1)),e("div",S,[i[1]||(i[1]=e("h2",null,"Crear publicación",-1)),x(e("input",{"onUpdate:modelValue":i[0]||(i[0]=a=>o.value=a),placeholder:"Descripción",class:"form-control"},null,512),[[P,o.value]]),e("input",{type:"file",accept:"image/*,video/*",onChange:f,class:"form-control"},null,32),e("button",{class:"btn btn-primary mt-2",onClick:g},"Publicar")]),e("div",A,[i[2]||(i[2]=e("h2",null,"Publicaciones actuales",-1)),d.value.length===0?(n(),s("div",F,"No hay publicaciones.")):$("",!0),e("div",B,[(n(!0),s(D,null,N(d.value,a=>(n(),s("div",{key:a.id,class:"publicacion-card"},[e("div",L,[e("img",{class:"avatar",src:p(a.fotoAdmin||"/file.png"),alt:"Admin avatar"},null,8,M),e("div",null,[e("strong",null,v(a.adminNombre),1),e("p",null,v(new Date(a.fechaCreacion).toLocaleString("es-MX")),1)])]),e("p",j,v(a.descripcion),1),a.esVideo?(n(),s("div",z,[e("video",{class:"media",controls:"",src:p(a.mediaUrl)},null,8,T)])):(n(),s("div",W,[e("img",{class:"media",src:p(a.mediaUrl)},null,8,X)])),e("div",q,[e("button",{class:"btn btn-danger",onClick:h=>y(a.id)},"🗑 Eliminar",8,G)])]))),128))])])])]))}}),R=V(H,[["__scopeId","data-v-6ec227b2"]]);export{R as default};
