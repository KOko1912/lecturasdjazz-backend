import{j as h,r as s,o as C,u as N,c as r,d as o,f as l,b as x,k as P,l as b,t as u,F as B,g as E,a}from"./index-CW287Eje.js";import{a as $}from"./index-Dq7h7Pqt.js";const w={key:0},z={key:1},A=["src"],F={key:0},V={key:1},k="/default-avatar.png",M=h({__name:"Usuario",setup(j){const p=N(),f="https://lecturasdjazz-api.onrender.com",i=s(localStorage.getItem("token")),n=s(JSON.parse(localStorage.getItem("usuario")||"null")),d=s(""),m=s([]),g=s(!0);function _(){d.value=k}function v(){localStorage.removeItem("token"),localStorage.removeItem("usuario"),p.push("/login")}function y(t){return new Date(t).toLocaleString("es-MX")}async function S(){try{const{data:t}=await $.get(`${f}/api/pedidos/mis-pedidos`,{headers:{Authorization:`Bearer ${i.value}`}});m.value=Array.isArray(t)?t:[]}catch(t){console.error("❌ Error al cargar pedidos:",t),t?.response?.status===401&&v()}finally{g.value=!1}}return C(()=>{if(!i.value||!n.value){p.push("/login");return}d.value=`${f}/${(n.value.fotoUrl||k).replace(/^\/+/,"")}`,S()}),(t,e)=>{const I=b("router-link");return a(),r("div",null,[e[5]||(e[5]=o("h1",null,"👤 Perfil",-1)),!n.value||!i.value?(a(),r("div",w,[o("p",null,[e[1]||(e[1]=l("No estás autenticado. ")),x(I,{to:"/login"},{default:P(()=>e[0]||(e[0]=[l("Iniciar sesión")])),_:1,__:[0]})])])):(a(),r("div",z,[o("img",{src:d.value,onError:_},null,40,A),o("p",null,[e[2]||(e[2]=o("strong",null,"Nombre:",-1)),l(" "+u(n.value.nombre),1)]),o("p",null,[e[3]||(e[3]=o("strong",null,"Teléfono:",-1)),l(" "+u(n.value.telefono),1)]),o("button",{onClick:v},"Cerrar sesión"),e[4]||(e[4]=o("h2",null,"Pedidos",-1)),g.value?(a(),r("div",F,"Cargando pedidos...")):(a(),r("ul",V,[(a(!0),r(B,null,E(m.value,c=>(a(),r("li",{key:c.uuid},u(c.producto?.titulo)+" - "+u(y(c.fechaPedido)),1))),128))]))]))])}}});export{M as default};
