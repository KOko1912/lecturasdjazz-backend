import{a as z}from"./index-Dq7h7Pqt.js";import{j as T,r as i,k as y,o as D,c as r,b as N,d as o,u as R,f as A,t as u,F as h,g as k,a as n,l as U}from"./index-C0pr5oqr.js";import{u as V,N as j}from"./NavbarHome-W1ZR71uZ.js";import M from"./Login-CYvwjelR.js";const _={key:0},H={key:1},J={key:2},O=["src"],X={key:0},q={key:1},G="/default-avatar.png",ee=T({__name:"Usuario",setup(K){const{token:P,usuario:l,logout:c,isLoggedIn:F}=V();U();const f="https://lecturasdjazz-api.onrender.com",p=i(""),m=i(""),s=i(""),d=i([]),C=i(!0),$=i(!0),I=y(()=>d.value.filter(a=>a.estado==="Pendiente")),w=y(()=>d.value.filter(a=>a.estado==="Completado")),x=y(()=>d.value.filter(a=>a.estado==="Rechazado"));function g(a){return new Date(a).toLocaleString("es-MX")}function B(){c(),p.value="",m.value="",s.value="",d.value=[]}function E(){s.value=G}async function L(){try{const{data:a}=await z.get(`${f}/api/pedidos/mis-pedidos`,{headers:{Authorization:`Bearer ${P.value}`}});d.value=Array.isArray(a)?a:[]}catch(a){console.error("Error al cargar pedidos:",a),a?.response?.status===401&&c()}finally{C.value=!1}}async function S(a){const e=a.target.files?.[0];if(!e||!l.value)return;const t=new FormData;t.append("archivo",e);try{const{data:v}=await z.post(`${f}/api/usuario/upload-photo?userId=${l.value.id}`,t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${P.value}`}});s.value=`${f}/${v.ruta}`,l.value.fotoUrl=v.ruta,localStorage.setItem("usuario",JSON.stringify(l.value))}catch(v){console.error("Error subiendo imagen:",v)}}function b(){if(!l.value||!l.value.id){console.warn("Usuario inválido. Redirigiendo a login..."),c();return}p.value=l.value.nombre||"",m.value=l.value.telefono||"",s.value=`${f}/${(l.value.fotoUrl||"default-avatar.png").replace(/^\/+/,"")}`,L()}return D(()=>{F()&&b(),$.value=!1}),(a,e)=>(n(),r("div",null,[N(j),$.value?(n(),r("div",_,e[0]||(e[0]=[o("p",{style:{"text-align":"center","margin-top":"2rem"}},"Cargando...",-1)]))):R(l)?.id?(n(),r("div",J,[e[8]||(e[8]=o("h1",null,"✨ Tu Perfil",-1)),o("div",null,[o("img",{src:s.value,alt:"Foto de perfil",onError:E},null,40,O),o("input",{type:"file",onChange:S,accept:"image/*"},null,32)]),o("div",null,[o("p",null,[e[1]||(e[1]=o("strong",null,"Nombre:",-1)),A(" "+u(p.value),1)]),o("p",null,[e[2]||(e[2]=o("strong",null,"Teléfono:",-1)),A(" "+u(m.value),1)]),o("button",{onClick:B},"Cerrar sesión")]),o("div",null,[e[7]||(e[7]=o("h2",null,"📦 Tus Pedidos",-1)),C.value?(n(),r("div",X,e[3]||(e[3]=[o("p",null,"Cargando tus pedidos...",-1)]))):(n(),r("div",q,[e[4]||(e[4]=o("h3",null,"🟡 Pendientes",-1)),o("ul",null,[(n(!0),r(h,null,k(I.value,t=>(n(),r("li",{key:t.uuid},u(t.producto.titulo)+" - "+u(g(t.fechaPedido)),1))),128))]),e[5]||(e[5]=o("h3",null,"✅ Aprobados",-1)),o("ul",null,[(n(!0),r(h,null,k(w.value,t=>(n(),r("li",{key:t.uuid},u(t.producto.titulo)+" - "+u(g(t.fechaPedido)),1))),128))]),e[6]||(e[6]=o("h3",null,"❌ Rechazados",-1)),o("ul",null,[(n(!0),r(h,null,k(x.value,t=>(n(),r("li",{key:t.uuid},u(t.producto.titulo)+" - "+u(g(t.fechaPedido)),1))),128))])]))])])):(n(),r("div",H,[N(M,{onLogueado:b})]))]))}});export{ee as default};
