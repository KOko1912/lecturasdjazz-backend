import{p as A,r as g,j as K,o as X,c as d,b as Y,d as t,e as k,f as L,h as c,v,F as w,g as V,s as b,t as p,m as _,B as P,C as Z,a as u,n as $,u as tt,_ as st}from"./index---WEDpbZ.js";import{N as at}from"./NavbarAdmin-Av1Mc6gG.js";import{a as x}from"./index-Dq7h7Pqt.js";const C=g([]),m=g(""),O=g(""),U=g(""),I=g(!1),D=g(!1),N=A(()=>[...new Set(C.value.map(o=>o.categoria||"Sin Categoría"))].sort()),ot=A(()=>C.value.filter(o=>{const i=(o.titulo||"").toLowerCase(),e=(o.descripcion||"").toLowerCase(),f=o.categoria||"",l=O.value.toLowerCase();return(i.includes(l)||e.includes(l))&&(!U.value||f===U.value)&&(!I.value||o.activo)&&(!D.value||o.destacado)})),et=A(()=>{const o={};for(const i of ot.value){const e=i.categoria||"Sin Categoría";o[e]||(o[e]=[]),o[e].push(i)}return o});function R(o){return o?o.startsWith("http")?o:`import.meta.env.VITE_API_URL${o}`:"/placeholder.jpg"}async function E(){try{const{data:o}=await x.get("import.meta.env.VITE_API_URL/api/admin/productos");C.value=o,console.log("📦 Productos cargados:",C.value)}catch(o){m.value=o.response?.data?.message||"Error al cargar productos"}}function lt(o){const i=o?.precio??0,e=o?.porcentajeOferta??0;return o.enOferta?i*(1-e/100):i}async function nt(o){try{const i={titulo:o.titulo??"",descripcion:o.descripcion??"",precio:o.precio??0,enOferta:o.enOferta??!1,porcentajeOferta:o.porcentajeOferta??0,imagenUrl:o.imagenUrl??"",stock:o.stock??0,activo:!0,categoria:o.categoria??"",destacado:o.destacado??!1},{data:e}=await x.post("import.meta.env.VITE_API_URL/api/admin/productos",i);C.value.push(e)}catch(i){m.value=i.response?.data?.message||"Error al crear producto"}}async function rt(o){try{await x.put(`import.meta.env.VITE_API_URL/api/admin/productos/${o.uuid}`,o),await E()}catch(i){m.value=i.response?.data?.message||"Error al actualizar producto"}}async function it(o){try{await x.delete(`import.meta.env.VITE_API_URL/api/admin/productos/${o}/permanente`),await E()}catch{m.value="Error al eliminar producto permanentemente"}}async function ct(o){try{await x.patch(`import.meta.env.VITE_API_URL/api/admin/productos/${o}/toggle-activo`),await E()}catch{m.value="Error al actualizar estado del producto"}}async function z(o,i="admin"){const e=new FormData;e.append("imagen",o),e.append("nombreUsuario",i);const{data:f}=await x.post("import.meta.env.VITE_API_URL/api/admin/productos/upload-imagen",e,{headers:{"Content-Type":"multipart/form-data"}});return f.imageUrl}const dt={class:"admin-products-page"},ut={class:"admin-container"},pt={class:"card product-form"},mt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},vt={class:"form-group"},bt={class:"form-group"},ft={id:"categorias"},gt=["value"],kt={class:"form-group"},yt={class:"form-group"},xt={class:"file-upload"},_t={class:"upload-label"},Ct={class:"upload-text"},Ut={class:"form-group"},Et={class:"input-with-symbol"},ht={class:"form-group"},wt={class:"form-group col-span-2 flex items-center gap-4"},Vt={class:"checkbox-label"},Pt={key:0,class:"form-group flex-1"},Ot={class:"input-with-symbol"},It={class:"checkbox-label ml-auto"},Dt={class:"card filters-section"},$t={class:"flex flex-col md:flex-row gap-4 items-center"},At={class:"search-group flex-1"},Tt=["value"],St={class:"flex gap-4"},jt={class:"checkbox-label"},Lt={class:"checkbox-label"},Nt={key:0,class:"empty-state card"},Rt={key:1},zt={class:"category-header"},Bt={class:"text-gradient"},Ft={class:"badge"},Mt={class:"products-grid"},qt={class:"product-image-container"},Gt=["src","alt"],Qt={key:0,class:"inactive-badge"},Wt={key:1,class:"featured-badge"},Ht={key:2,class:"discount-badge"},Jt={class:"product-details"},Kt={class:"product-title"},Xt={class:"product-description"},Yt={class:"price-section"},Zt={class:"current-price"},ts={key:0,class:"original-price"},ss={class:"stock-info"},as={class:"stock-value"},os={class:"product-actions"},es=["onClick"],ls=["onClick"],ns=["onClick"],rs=["onClick"],is=["onClick"],cs={key:2,class:"modal-overlay"},ds={class:"modal-content card"},us={class:"modal-body"},ps={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ms={class:"form-group"},vs={class:"form-group"},bs={class:"form-group col-span-2"},fs={class:"form-group"},gs={class:"input-with-symbol"},ks={class:"form-group"},ys={class:"form-group col-span-2 flex items-center gap-4"},xs={class:"checkbox-label"},_s={key:0,class:"form-group flex-1"},Cs={class:"input-with-symbol"},Us={class:"checkbox-label ml-auto"},Es={class:"form-group col-span-2"},hs=["src"],ws={class:"form-group col-span-2"},Vs={class:"file-upload"},Ps={class:"upload-label"},Os={class:"upload-text"},Is={key:3,class:"error-message card"},Ds=K({__name:"Productos",setup(o){const i=tt(),e=g({titulo:"",descripcion:"",precio:0,categoria:"",stock:0,imagenUrl:"",enOferta:!1,porcentajeOferta:0,destacado:!1}),f=g(null),l=g(null),y=g(null),B=n=>{const s=n.target;s.files&&s.files[0]&&(f.value=s.files[0])},F=n=>{const s=n.target;s.files&&s.files[0]&&(y.value=s.files[0])},T=n=>{const s=n.target;s.src="/placeholder-product.png"},M=async()=>{if(!e.value.titulo||e.value.precio<=0){m.value="El título y el precio son obligatorios";return}if(f.value)try{const n=await z(f.value);e.value.imagenUrl=n}catch{m.value="Error al subir la imagen";return}await nt(e.value),e.value={titulo:"",descripcion:"",precio:0,categoria:"",stock:0,imagenUrl:"",enOferta:!1,porcentajeOferta:0,destacado:!1},f.value=null,m.value=""},q=async n=>await ct(n),G=async n=>{confirm("¿Estás seguro de eliminar este producto permanentemente?")&&await it(n)},Q=async n=>{try{await x.put(`https://lecturasdjazz-api.onrender.com/api/admin/productos/${n.uuid}`,{...n,destacado:!n.destacado}),await E()}catch{m.value="Error al actualizar el producto."}},W=n=>{l.value={...n},y.value=null},H=async()=>{if(!l.value.titulo||l.value.precio<=0){m.value="Título y precio son obligatorios";return}try{if(y.value){const n=await z(y.value);l.value.imagenUrl=n}await rt(l.value),l.value=null,m.value=""}catch{m.value="Error al guardar los cambios."}},S=()=>{l.value=null,y.value=null},J=n=>{i.push({name:"ProductoDetalle",params:{uuid:n}})};return X(E),(n,s)=>(u(),d("div",dt,[Y(at),t("div",ut,[s[61]||(s[61]=t("div",{class:"admin-header"},[t("h1",{class:"text-gradient"},"Gestión de Productos"),t("p",{class:"admin-subtitle"},"Administra y organiza tu catálogo de productos")],-1)),t("div",pt,[s[35]||(s[35]=t("h2",{class:"card-title"},[t("i",{class:"card-icon"},"✨"),L(" Nuevo Producto ")],-1)),t("div",mt,[t("div",vt,[s[20]||(s[20]=t("label",{class:"form-label"},"Título",-1)),c(t("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>e.value.titulo=a),placeholder:"Nombre del producto",class:"form-control"},null,512),[[v,e.value.titulo]])]),t("div",bt,[s[21]||(s[21]=t("label",{class:"form-label"},"Categoría",-1)),c(t("input",{"onUpdate:modelValue":s[1]||(s[1]=a=>e.value.categoria=a),placeholder:"Categoría",class:"form-control",list:"categorias"},null,512),[[v,e.value.categoria]]),t("datalist",ft,[(u(!0),d(w,null,V(b(N),a=>(u(),d("option",{key:a,value:a},null,8,gt))),128))])]),t("div",kt,[s[22]||(s[22]=t("label",{class:"form-label"},"Descripción",-1)),c(t("textarea",{"onUpdate:modelValue":s[2]||(s[2]=a=>e.value.descripcion=a),placeholder:"Descripción detallada",class:"form-control",rows:"3"},null,512),[[v,e.value.descripcion]])]),t("div",yt,[s[24]||(s[24]=t("label",{class:"form-label"},"Imagen",-1)),t("div",xt,[t("label",_t,[t("input",{type:"file",onChange:B,accept:"image/*",class:"file-input"},null,32),t("span",Ct,p(f.value?f.value.name:"Seleccionar imagen"),1),s[23]||(s[23]=t("span",{class:"upload-btn"},"Examinar",-1))])])]),t("div",Ut,[s[26]||(s[26]=t("label",{class:"form-label"},"Precio",-1)),t("div",Et,[s[25]||(s[25]=t("span",{class:"symbol"},"$",-1)),c(t("input",{"onUpdate:modelValue":s[3]||(s[3]=a=>e.value.precio=a),type:"number",placeholder:"0.00",class:"form-control"},null,512),[[v,e.value.precio,void 0,{number:!0}]])])]),t("div",ht,[s[27]||(s[27]=t("label",{class:"form-label"},"Stock",-1)),c(t("input",{"onUpdate:modelValue":s[4]||(s[4]=a=>e.value.stock=a),type:"number",placeholder:"Cantidad disponible",class:"form-control"},null,512),[[v,e.value.stock,void 0,{number:!0}]])]),t("div",wt,[t("label",Vt,[c(t("input",{type:"checkbox","onUpdate:modelValue":s[5]||(s[5]=a=>e.value.enOferta=a),class:"checkbox-input"},null,512),[[_,e.value.enOferta]]),s[28]||(s[28]=t("span",{class:"checkbox-custom"},null,-1)),s[29]||(s[29]=t("span",{class:"checkbox-text"},"En oferta",-1))]),e.value.enOferta?(u(),d("div",Pt,[s[31]||(s[31]=t("label",{class:"form-label"},"Descuento",-1)),t("div",Ot,[c(t("input",{"onUpdate:modelValue":s[6]||(s[6]=a=>e.value.porcentajeOferta=a),type:"number",placeholder:"0",class:"form-control"},null,512),[[v,e.value.porcentajeOferta,void 0,{number:!0}]]),s[30]||(s[30]=t("span",{class:"symbol"},"%",-1))])])):k("",!0),t("label",It,[c(t("input",{type:"checkbox","onUpdate:modelValue":s[7]||(s[7]=a=>e.value.destacado=a),class:"checkbox-input"},null,512),[[_,e.value.destacado]]),s[32]||(s[32]=t("span",{class:"checkbox-custom"},null,-1)),s[33]||(s[33]=t("span",{class:"checkbox-text"},"Destacado",-1))])])]),t("button",{class:"btn btn-primary mt-4",onClick:M},s[34]||(s[34]=[t("i",{class:"btn-icon"},"➕",-1),L(" Crear Producto ")]))]),t("div",Dt,[t("div",$t,[t("div",At,[s[36]||(s[36]=t("i",{class:"search-icon"},"🔍",-1)),c(t("input",{"onUpdate:modelValue":s[8]||(s[8]=a=>P(O)?O.value=a:null),placeholder:"Buscar productos...",class:"search-input"},null,512),[[v,b(O)]])]),c(t("select",{"onUpdate:modelValue":s[9]||(s[9]=a=>P(U)?U.value=a:null),class:"form-control w-full md:w-auto"},[s[37]||(s[37]=t("option",{value:""},"Todas las categorías",-1)),(u(!0),d(w,null,V(b(N),a=>(u(),d("option",{key:a,value:a},p(a),9,Tt))),128))],512),[[Z,b(U)]]),t("div",St,[t("label",jt,[c(t("input",{type:"checkbox","onUpdate:modelValue":s[10]||(s[10]=a=>P(I)?I.value=a:null),class:"checkbox-input"},null,512),[[_,b(I)]]),s[38]||(s[38]=t("span",{class:"checkbox-custom"},null,-1)),s[39]||(s[39]=t("span",{class:"checkbox-text"},"Solo activos",-1))]),t("label",Lt,[c(t("input",{type:"checkbox","onUpdate:modelValue":s[11]||(s[11]=a=>P(D)?D.value=a:null),class:"checkbox-input"},null,512),[[_,b(D)]]),s[40]||(s[40]=t("span",{class:"checkbox-custom"},null,-1)),s[41]||(s[41]=t("span",{class:"checkbox-text"},"Solo destacados",-1))])])])]),b(C).length===0?(u(),d("div",Nt,s[42]||(s[42]=[t("i",{class:"empty-icon"},"📦",-1),t("h3",null,"No hay productos para mostrar",-1),t("p",null,"Crea tu primer producto usando el formulario superior",-1)]))):(u(),d("div",Rt,[(u(!0),d(w,null,V(b(et),(a,j)=>(u(),d("div",{key:j,class:"category-section"},[t("div",zt,[t("h2",Bt,p(j),1),t("span",Ft,p(a.length)+" productos",1)]),t("div",Mt,[(u(!0),d(w,null,V(a,r=>(u(),d("div",{key:r.uuid,class:$(["product-card",{"inactive-product":!r.activo,"featured-product":r.destacado}])},[t("div",qt,[t("img",{src:b(R)(r.imagenUrl),alt:r.titulo,class:"product-image",onError:T},null,40,Gt),r.activo?k("",!0):(u(),d("div",Qt,"INACTIVO")),r.destacado?(u(),d("div",Wt,"⭐ DESTACADO")):k("",!0),r.enOferta?(u(),d("div",Ht," -"+p(r.porcentajeOferta)+"% ",1)):k("",!0)]),t("div",Jt,[t("h3",Kt,p(r.titulo),1),t("p",Xt,p(r.descripcion),1),t("div",Yt,[t("span",Zt," $"+p(b(lt)(r).toFixed(2)),1),r.enOferta?(u(),d("span",ts," $"+p(r.precio.toFixed(2)),1)):k("",!0)]),t("div",ss,[s[43]||(s[43]=t("span",{class:"stock-label"},"Stock:",-1)),t("span",as,p(r.stock)+" unidades",1)])]),t("div",os,[t("button",{class:$(["btn btn-sm",r.activo?"btn-secondary":"btn-success"]),onClick:h=>q(r.uuid)},p(r.activo?"Desactivar":"Activar"),11,es),t("button",{class:$(["btn btn-sm",r.destacado?"btn-warning":"btn-secondary"]),onClick:h=>Q(r)},p(r.destacado?"⭐ Quitar":"Destacar"),11,ls),t("button",{class:"btn btn-sm btn-danger",onClick:h=>G(r.uuid)}," 🗑️ Eliminar ",8,ns),t("button",{class:"btn btn-sm btn-primary",onClick:h=>W(r)}," ✏️ Editar ",8,rs),t("button",{class:"btn btn-sm btn-info",onClick:h=>J(r.uuid)}," 🔍 Detalles ",8,is)])],2))),128))])]))),128))])),l.value?(u(),d("div",cs,[t("div",ds,[t("div",{class:"modal-header"},[s[44]||(s[44]=t("h2",{class:"modal-title"},"Editar Producto",-1)),t("button",{class:"modal-close",onClick:S}," × ")]),t("div",us,[t("div",ps,[t("div",ms,[s[45]||(s[45]=t("label",{class:"form-label"},"Título",-1)),c(t("input",{"onUpdate:modelValue":s[12]||(s[12]=a=>l.value.titulo=a),class:"form-control"},null,512),[[v,l.value.titulo]])]),t("div",vs,[s[46]||(s[46]=t("label",{class:"form-label"},"Categoría",-1)),c(t("input",{"onUpdate:modelValue":s[13]||(s[13]=a=>l.value.categoria=a),class:"form-control"},null,512),[[v,l.value.categoria]])]),t("div",bs,[s[47]||(s[47]=t("label",{class:"form-label"},"Descripción",-1)),c(t("textarea",{"onUpdate:modelValue":s[14]||(s[14]=a=>l.value.descripcion=a),class:"form-control",rows:"3"},null,512),[[v,l.value.descripcion]])]),t("div",fs,[s[49]||(s[49]=t("label",{class:"form-label"},"Precio",-1)),t("div",gs,[s[48]||(s[48]=t("span",{class:"symbol"},"$",-1)),c(t("input",{"onUpdate:modelValue":s[15]||(s[15]=a=>l.value.precio=a),type:"number",class:"form-control"},null,512),[[v,l.value.precio,void 0,{number:!0}]])])]),t("div",ks,[s[50]||(s[50]=t("label",{class:"form-label"},"Stock",-1)),c(t("input",{"onUpdate:modelValue":s[16]||(s[16]=a=>l.value.stock=a),type:"number",class:"form-control"},null,512),[[v,l.value.stock,void 0,{number:!0}]])]),t("div",ys,[t("label",xs,[c(t("input",{type:"checkbox","onUpdate:modelValue":s[17]||(s[17]=a=>l.value.enOferta=a),class:"checkbox-input"},null,512),[[_,l.value.enOferta]]),s[51]||(s[51]=t("span",{class:"checkbox-custom"},null,-1)),s[52]||(s[52]=t("span",{class:"checkbox-text"},"En oferta",-1))]),l.value.enOferta?(u(),d("div",_s,[s[54]||(s[54]=t("label",{class:"form-label"},"Descuento",-1)),t("div",Cs,[c(t("input",{"onUpdate:modelValue":s[18]||(s[18]=a=>l.value.porcentajeOferta=a),type:"number",class:"form-control"},null,512),[[v,l.value.porcentajeOferta,void 0,{number:!0}]]),s[53]||(s[53]=t("span",{class:"symbol"},"%",-1))])])):k("",!0),t("label",Us,[c(t("input",{type:"checkbox","onUpdate:modelValue":s[19]||(s[19]=a=>l.value.destacado=a),class:"checkbox-input"},null,512),[[_,l.value.destacado]]),s[55]||(s[55]=t("span",{class:"checkbox-custom"},null,-1)),s[56]||(s[56]=t("span",{class:"checkbox-text"},"Destacado",-1))])]),t("div",Es,[s[57]||(s[57]=t("label",{class:"form-label"},"Imagen actual",-1)),t("img",{src:b(R)(l.value.imagenUrl),class:"current-image",onError:T},null,40,hs)]),t("div",ws,[s[59]||(s[59]=t("label",{class:"form-label"},"Cambiar imagen",-1)),t("div",Vs,[t("label",Ps,[t("input",{type:"file",onChange:F,accept:"image/*",class:"file-input"},null,32),t("span",Os,p(y.value?y.value.name:"Seleccionar nueva imagen"),1),s[58]||(s[58]=t("span",{class:"upload-btn"},"Examinar",-1))])])])])]),t("div",{class:"modal-footer"},[t("button",{class:"btn btn-secondary",onClick:S}," Cancelar "),t("button",{class:"btn btn-primary",onClick:H}," Guardar Cambios ")])])])):k("",!0),b(m)?(u(),d("div",Is,[s[60]||(s[60]=t("i",{class:"error-icon"},"⚠️",-1)),t("p",null,p(b(m)),1)])):k("",!0)])]))}}),Ss=st(Ds,[["__scopeId","data-v-1ca12a44"]]);export{Ss as default};
