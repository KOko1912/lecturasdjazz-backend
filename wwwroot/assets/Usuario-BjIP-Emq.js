import{a as N}from"./index-Dq7h7Pqt.js";import{j as x,r as d,k as y,o as D,c as r,u as R,b as h,d as o,f as A,t as u,F as k,g as P,a as l,l as U}from"./index-B3BHKLRW.js";import{N as F}from"./NavbarHome-B_xzC9lf.js";import{u as V,L as j}from"./Login-wgktlaxm.js";const M={key:0},_={key:1},H=["src"],J={key:0},O={key:1},X="/default-avatar.png",Y=x({__name:"Usuario",setup(q){const{token:$,usuario:n,logout:v,isLoggedIn:b}=V();U();const f="https://lecturasdjazz-api.onrender.com",p=d(""),m=d(""),i=d(""),s=d([]),z=d(!0),I=y(()=>s.value.filter(a=>a.estado==="Pendiente")),L=y(()=>s.value.filter(a=>a.estado==="Completado")),w=y(()=>s.value.filter(a=>a.estado==="Rechazado"));function g(a){return new Date(a).toLocaleString("es-MX")}function B(){v(),p.value="",m.value="",i.value="",s.value=[]}function E(){i.value=X}async function S(){try{const{data:a}=await N.get(`${f}/api/pedidos/mis-pedidos`,{headers:{Authorization:`Bearer ${$.value}`}});s.value=Array.isArray(a)?a:[]}catch(a){console.error("Error al cargar pedidos:",a),a?.response?.status===401&&v()}finally{z.value=!1}}async function T(a){const e=a.target.files?.[0];if(!e||!n.value)return;const t=new FormData;t.append("archivo",e);try{const{data:c}=await N.post(`${f}/api/usuario/upload-photo?userId=${n.value.id}`,t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${$.value}`}});i.value=`${f}/${c.ruta}`,n.value.fotoUrl=c.ruta,localStorage.setItem("usuario",JSON.stringify(n.value))}catch(c){console.error("Error subiendo imagen:",c)}}function C(){if(!n.value||!n.value.id){console.warn("Usuario inválido. Redirigiendo a login..."),v();return}p.value=n.value.nombre||"",m.value=n.value.telefono||"",i.value=`${f}/${(n.value.fotoUrl||"default-avatar.png").replace(/^\/+/,"")}`,S()}return D(()=>{b()&&C()}),(a,e)=>(l(),r("div",null,[R(b)()?(l(),r("div",_,[h(F),e[7]||(e[7]=o("h1",null,"✨ Tu Perfil",-1)),o("div",null,[o("img",{src:i.value,alt:"Foto de perfil",onError:E},null,40,H),o("input",{type:"file",onChange:T,accept:"image/*"},null,32)]),o("div",null,[o("p",null,[e[0]||(e[0]=o("strong",null,"Nombre:",-1)),A(" "+u(p.value),1)]),o("p",null,[e[1]||(e[1]=o("strong",null,"Teléfono:",-1)),A(" "+u(m.value),1)]),o("button",{onClick:B},"Cerrar sesión")]),o("div",null,[e[6]||(e[6]=o("h2",null,"📦 Tus Pedidos",-1)),z.value?(l(),r("div",J,e[2]||(e[2]=[o("p",null,"Cargando tus pedidos...",-1)]))):(l(),r("div",O,[e[3]||(e[3]=o("h3",null,"🟡 Pendientes",-1)),o("ul",null,[(l(!0),r(k,null,P(I.value,t=>(l(),r("li",{key:t.uuid},u(t.producto.titulo)+" - "+u(g(t.fechaPedido)),1))),128))]),e[4]||(e[4]=o("h3",null,"✅ Aprobados",-1)),o("ul",null,[(l(!0),r(k,null,P(L.value,t=>(l(),r("li",{key:t.uuid},u(t.producto.titulo)+" - "+u(g(t.fechaPedido)),1))),128))]),e[5]||(e[5]=o("h3",null,"❌ Rechazados",-1)),o("ul",null,[(l(!0),r(k,null,P(w.value,t=>(l(),r("li",{key:t.uuid},u(t.producto.titulo)+" - "+u(g(t.fechaPedido)),1))),128))])]))])])):(l(),r("div",M,[h(F),h(j,{onLogueado:C})]))]))}});export{Y as default};
