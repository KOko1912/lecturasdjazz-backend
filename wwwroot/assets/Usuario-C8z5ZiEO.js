import{j as I,r as l,o as h,u as C,c as t,d as o,f as s,b as N,k as x,l as P,t as u,F as b,g as B,a as r}from"./index-BHI-bEV9.js";import{a as E}from"./index-Dq7h7Pqt.js";const $={key:0},w={key:1},z=["src"],F={key:0},V={key:1},j="/default-avatar.png",T=I({__name:"Usuario",setup(D){const p=C(),f="https://lecturasdjazz-api.onrender.com",i=l(localStorage.getItem("token")),n=l(JSON.parse(localStorage.getItem("usuario")||"null")),d=l(""),g=l([]),m=l(!0);function v(){d.value=j}function k(){localStorage.removeItem("token"),localStorage.removeItem("usuario"),p.push("/login")}function _(a){return new Date(a).toLocaleString("es-MX")}async function y(){try{const{data:a}=await E.get(`${f}/api/pedidos/mis-pedidos`,{headers:{Authorization:`Bearer ${i.value}`}});g.value=a}catch(a){console.error("❌ Error al cargar pedidos:",a)}finally{m.value=!1}}return h(()=>{if(!n.value||!i.value){p.push("/login");return}d.value=`${f}/${(n.value.fotoUrl||"default-avatar.png").replace(/^\/+/,"")}`,y()}),(a,e)=>{const S=P("router-link");return r(),t("div",null,[e[5]||(e[5]=o("h1",null,"👤 Perfil",-1)),!n.value||!i.value?(r(),t("div",$,[o("p",null,[e[1]||(e[1]=s("No estás autenticado. ")),N(S,{to:"/login"},{default:x(()=>e[0]||(e[0]=[s("Iniciar sesión")])),_:1,__:[0]})])])):(r(),t("div",w,[o("img",{src:d.value,onError:v},null,40,z),o("p",null,[e[2]||(e[2]=o("strong",null,"Nombre:",-1)),s(" "+u(n.value.nombre),1)]),o("p",null,[e[3]||(e[3]=o("strong",null,"Teléfono:",-1)),s(" "+u(n.value.telefono),1)]),o("button",{onClick:k},"Cerrar sesión"),e[4]||(e[4]=o("h2",null,"Pedidos",-1)),m.value?(r(),t("div",F,"Cargando pedidos...")):(r(),t("ul",V,[(r(!0),t(b,null,B(g.value,c=>(r(),t("li",{key:c.uuid},u(c.producto.titulo)+" - "+u(_(c.fechaPedido)),1))),128))]))]))])}}});export{T as default};
